#
# (C) Tenable Network Security, Inc.
#

include("compat.inc");

if (description)
{
  script_id(121109);
  script_version("1.6");
  script_set_attribute(attribute:"plugin_modification_date", value:"2022/01/25");

  script_cve_id("CVE-2019-0548");
  script_bugtraq_id(106410);

  script_name(english:"ASP.NET Core Denial of Service Vulnerability (January 2019)");
  script_summary(english:"Checks the version of AspNetCoreModule(ANCM).");

  script_set_attribute(attribute:"synopsis", value:
"The Microsoft ASP.NET Core Hosting Bundle installation on the remote host contains vulnerable package.");
  script_set_attribute(attribute:"description", value:
"A denial of service (DoS) vulnerability exists in
ASP.NET Core Hosting Bundle module AspNetCoreModule (ANCM)
due to improper handling of web requests. An unauthenticated, remote
attacker can exploit this issue, via specially crafted requests, to cause the
hosted application to stop responding..");
  # https://github.com/aspnet/Announcements/issues/335
  script_set_attribute(attribute:"see_also", value:"http://www.nessus.org/u?ebe0256b");
  # https://github.com/aspnet/AspNetCore/issues/6488
  script_set_attribute(attribute:"see_also", value:"http://www.nessus.org/u?612fb821");
  script_set_attribute(attribute:"solution", value:
"Update ASP.NET Core, remove vulnerable packages and refer to vendor advisory.");
  script_set_cvss_base_vector("CVSS2#AV:N/AC:L/Au:N/C:N/I:N/A:P");
  script_set_cvss_temporal_vector("CVSS2#E:U/RL:OF/RC:C");
  script_set_cvss3_base_vector("CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H");
  script_set_cvss3_temporal_vector("CVSS:3.0/E:U/RL:O/RC:C");
  script_set_attribute(attribute:"cvss_score_source", value:"CVE-2019-0548");

  script_set_attribute(attribute:"exploitability_ease", value:"No known exploits are available");

  script_set_attribute(attribute:"vuln_publication_date", value:"2019/01/08");
  script_set_attribute(attribute:"patch_publication_date", value:"2019/01/08");
  script_set_attribute(attribute:"plugin_publication_date", value:"2019/01/11");

  script_set_attribute(attribute:"potential_vulnerability", value:"true");
  script_set_attribute(attribute:"plugin_type", value:"local");
  script_set_attribute(attribute:"cpe", value:"cpe:/a:microsoft:asp.net_core");
  script_end_attributes();

  script_category(ACT_GATHER_INFO);
  script_family(english:"Windows");

  script_copyright(english:"This script is Copyright (C) 2019-2022 and is owned by Tenable, Inc. or an Affiliate thereof.");

  script_dependencies("smb_hotfixes.nasl");
  script_require_keys("Settings/ParanoidReport");
  script_require_ports(139, 445);

  exit(0);
}


include('audit.inc');
include('smb_func.inc');
include('smb_hotfixes_fcheck.inc');
include('smb_hotfixes.inc');
include('misc_func.inc');

if (report_paranoia < 2) audit(AUDIT_PARANOID);

app_name = 'Microsoft ASP.NET Core Hosting Bundle';
winroot = NULL;
aspnetcore = NULL;
version = NULL;
fix = NULL;

winroot = hotfix_get_systemroot();
if (!winroot) exit(1, "Failed to get the system root.");

aspnetcore =  winroot + '\\system32\\inetsrv\\aspnetcore.dll';
ver = hotfix_get_fversion(path:aspnetcore);
if (ver['error'] != HCF_OK) audit(AUDIT_NOT_DETECT, app_name);

version = join(ver['value'], sep:'.');
if (ver['value'][1] == 2)
{
  if (ver_compare(fix:'12.2.18346.0', ver:version) < 0)
    fix = '12.2.18346.0';
}
else if (ver_compare(fix:'12.1.18340.7', ver:version) < 0)
  fix = '12.1.18340.7';

if (empty_or_null(fix)) audit(AUDIT_HOST_NOT, "affected");

report = '\nAspNetCoreModule DLL: '  + aspnetcore;
report += '\nVersion: ' + version;
report += '\nFix: ' + fix;

security_report_v4(port:0, extra:report, severity:SECURITY_WARNING);
