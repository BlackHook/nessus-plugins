#%NASL_MIN_LEVEL 80900
##
# (C) Tenable, Inc.
##

include('compat.inc');

if (description)
{
  script_id(164328);
  script_version("1.5");
  script_set_attribute(attribute:"plugin_modification_date", value:"2023/02/17");

  script_cve_id("CVE-2022-37437");
  script_xref(name:"IAVA", value:"2022-A-0464-S");

  script_name(english:"Splunk Enterprise 9.0.0 < 9.0.1 (SVD-2022-0801)");

  script_set_attribute(attribute:"synopsis", value:
"An application running on a remote web server host is affected by a vulnerability");
  script_set_attribute(attribute:"description", value:
"The version of Splunk installed on the remote host is prior to tested version. It is, therefore, affected by a
vulnerability as referenced in the SVD-2022-0801 advisory.

  - When using Ingest Actions to configure a destination that resides on Amazon Simple Storage Service (S3) in
    Splunk Web, TLS certificate validation is not correctly performed and tested for the destination. The
    vulnerability only affects connections between Splunk Enterprise and an Ingest Actions Destination through
    Splunk Web and only applies to environments that have configured TLS certificate validation. It does not
    apply to Destinations configured directly in the outputs.conf configuration file. The vulnerability
    affects Splunk Enterprise version 9.0.0 and does not affect versions below 9.0.0, including the 8.1.x and
    8.2.x versions. (CVE-2022-37437)

Note that Nessus has not tested for this issue but has instead relied only on the application's self-reported version
number.");
  # https://www.splunk.com/en_us/product-security/announcements/svd-2022-0801.html
  script_set_attribute(attribute:"see_also", value:"http://www.nessus.org/u?0621785d");
  script_set_attribute(attribute:"solution", value:
"For Splunk Enterprise customers that use Ingest Actions, in particular to create or test new destinations, and have
configured TLS certificate validation, upgrade Splunk Enterprise 9.0.0 to 9.0.1 or higher.");
  script_set_attribute(attribute:"agent", value:"all");
  script_set_cvss_base_vector("CVSS2#AV:N/AC:L/Au:N/C:C/I:C/A:C");
  script_set_cvss_temporal_vector("CVSS2#E:U/RL:OF/RC:C");
  script_set_cvss3_base_vector("CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H");
  script_set_cvss3_temporal_vector("CVSS:3.0/E:U/RL:O/RC:C");
  script_set_attribute(attribute:"cvss_score_source", value:"CVE-2022-37437");

  script_set_attribute(attribute:"exploitability_ease", value:"No known exploits are available");
  script_set_attribute(attribute:"exploit_available", value:"false");
  script_cwe_id(295);

  script_set_attribute(attribute:"vuln_publication_date", value:"2022/08/16");
  script_set_attribute(attribute:"patch_publication_date", value:"2022/08/16");
  script_set_attribute(attribute:"plugin_publication_date", value:"2022/08/22");

  script_set_attribute(attribute:"potential_vulnerability", value:"true");
  script_set_attribute(attribute:"plugin_type", value:"combined");
  script_set_attribute(attribute:"cpe", value:"cpe:/a:splunk:splunk");
  script_set_attribute(attribute:"stig_severity", value:"I");
  script_end_attributes();

  script_category(ACT_GATHER_INFO);
  script_family(english:"CGI abuses");

  script_copyright(english:"This script is Copyright (C) 2022-2023 and is owned by Tenable, Inc. or an Affiliate thereof.");

  script_dependencies("splunkd_detect.nasl", "splunk_web_detect.nasl", "macos_splunk_installed.nbin", "splunk_win_installed.nbin");
  script_require_keys("installed_sw/Splunk", "Settings/ParanoidReport");

  exit(0);
}

include('vcf.inc');
include('vcf_extras_splunk.inc');

if (report_paranoia < 2) audit(AUDIT_PARANOID);

var app_info = vcf::splunk::get_app_info();

var constraints = [
  { 'min_version' : '9.0.0', 'fixed_version' : '9.0.1', 'license' : 'Enterprise' }
];
vcf::splunk::check_version_and_report(app_info:app_info, constraints:constraints, severity:SECURITY_HOLE);
