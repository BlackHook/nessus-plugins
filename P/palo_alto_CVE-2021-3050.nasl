#%NASL_MIN_LEVEL 70300
##
# (C) Tenable Network Security, Inc.
##

include('deprecated_nasl_level.inc');
include('compat.inc');

if (description)
{
  script_id(153213);
  script_version("1.2");
  script_set_attribute(attribute:"plugin_modification_date", value:"2021/09/13");

  script_cve_id("CVE-2021-3050");

  script_name(english:"Palo Alto Networks PAN-OS 9.0.10 < 9.0.15 / 9.1.4 < 9.1.11 / 10.0.x < 10.0.8 / 10.1.x < 10.1.2 OS Command Injection");

  script_set_attribute(attribute:"synopsis", value:
"The remote PAN-OS host is affected by an os command injection vulnerability.");
  script_set_attribute(attribute:"description", value:
"The version of Palo Alto Networks PAN-OS running on the remote host is 9.0.10 prior to 9.0.15, 9.1.4 prior to 9.1.11, 
10.0.x prior to 10.0.8 or 10.1.x prior to 10.1.2. It is, therefore, affected by a command injection vulnerability in 
its web interface component due to insufficient validation of user supplied input. An authenticated, remote attacker
can exploit this, by sending specially crafted requests, to execute arbitrary commands on an affected host.

Note that Nessus has not tested for this issue but has instead relied only on the application's self-reported version
number.");
  script_set_attribute(attribute:"see_also", value:"https://security.paloaltonetworks.com/CVE-2021-3050");
  script_set_attribute(attribute:"solution", value:
"Upgrade to PAN-OS 9.0.15 / 9.1.11 / 10.0.8 / 10.1.2 or later");
  script_set_cvss_base_vector("CVSS2#AV:N/AC:L/Au:S/C:C/I:C/A:C");
  script_set_cvss_temporal_vector("CVSS2#E:U/RL:OF/RC:C");
  script_set_cvss3_base_vector("CVSS:3.0/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H");
  script_set_cvss3_temporal_vector("CVSS:3.0/E:U/RL:O/RC:C");
  script_set_attribute(attribute:"cvss_score_source", value:"CVE-2021-3050");

  script_set_attribute(attribute:"exploitability_ease", value:"No known exploits are available");

  script_set_attribute(attribute:"vuln_publication_date", value:"2021/08/11");
  script_set_attribute(attribute:"patch_publication_date", value:"2021/08/11");
  script_set_attribute(attribute:"plugin_publication_date", value:"2021/09/10");

  script_set_attribute(attribute:"plugin_type", value:"combined");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:paloaltonetworks:pan-os");
  script_end_attributes();

  script_category(ACT_GATHER_INFO);
  script_family(english:"Palo Alto Local Security Checks");

  script_copyright(english:"This script is Copyright (C) 2021 and is owned by Tenable, Inc. or an Affiliate thereof.");

  script_dependencies("palo_alto_version.nbin");
  script_require_keys("Host/Palo_Alto/Firewall/Version", "Host/Palo_Alto/Firewall/Full_Version", "Host/Palo_Alto/Firewall/Source");

  exit(0);
}

include('vcf_extras.inc');

vcf::palo_alto::initialize();

var app_info = vcf::get_app_info(
  app:'Palo Alto Networks PAN-OS', 
  kb_ver:'Host/Palo_Alto/Firewall/Full_Version', 
  kb_source:'Host/Palo_Alto/Firewall/Source'
);

var constraints = [
  {'min_version': '9.0.10', 'fixed_version': '9.0.15'},
  {'min_version': '9.1.4', 'fixed_version': '9.1.11'},
  {'min_version': '10.0.0', 'fixed_version': '10.0.8'},
  {'min_version': '10.1.0', 'fixed_version': '10.1.2'}
];

vcf::check_version_and_report(
  app_info:app_info, 
  constraints:constraints, 
  severity:SECURITY_HOLE
);
