#%NASL_MIN_LEVEL 80900
##
# (C) Tenable, Inc.
##

include('compat.inc');

if (description)
{
  script_id(169506);
  script_version("1.1");
  script_set_attribute(attribute:"plugin_modification_date", value:"2023/01/05");

  script_cve_id("CVE-2022-0778");

  script_name(english:"Palo Alto GlobalProtect Agent 5.1 < 5.1.11 / 5.2 < 5.2.12 / 5.4 < 5.3.4 / 6.0 < 6.0.1  DoS");

  script_set_attribute(attribute:"synopsis", value:
"A VPN client installed on remote host is affected by a privilege escalation vulnerability.");
  script_set_attribute(attribute:"description", value:
"The version of Palo Alto GlobalProtect Agent installed on the remote host is affected by a denial of service (DoS)
vulnerability in the OpenSSL library which results in an infinite loop when parsing an invalid certificate.

Note that Nessus has not tested for this issue but has instead relied only on the application's self-reported version
number.");
  script_set_attribute(attribute:"see_also", value:"https://security.paloaltonetworks.com/CVE-2022-0778");
  script_set_attribute(attribute:"solution", value:
"Upgrade to Palo Alto GlobalProtect Agent 5.1.11, 5.2.12, 5.3.4, 6.0.1 or later");
  script_set_attribute(attribute:"agent", value:"all");
  script_set_cvss_base_vector("CVSS2#AV:N/AC:L/Au:N/C:N/I:N/A:P");
  script_set_cvss_temporal_vector("CVSS2#E:POC/RL:OF/RC:C");
  script_set_cvss3_base_vector("CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H");
  script_set_cvss3_temporal_vector("CVSS:3.0/E:P/RL:O/RC:C");
  script_set_attribute(attribute:"cvss_score_source", value:"CVE-2022-0778");

  script_set_attribute(attribute:"exploitability_ease", value:"Exploits are available");
  script_set_attribute(attribute:"exploit_available", value:"true");

  script_set_attribute(attribute:"vuln_publication_date", value:"2022/03/31");
  script_set_attribute(attribute:"patch_publication_date", value:"2022/03/31");
  script_set_attribute(attribute:"plugin_publication_date", value:"2023/01/04");

  script_set_attribute(attribute:"plugin_type", value:"local");
  script_set_attribute(attribute:"cpe", value:"cpe:/a:paloaltonetworks:globalprotect");
  script_end_attributes();

  script_category(ACT_GATHER_INFO);
  script_family(english:"Misc.");

  script_copyright(english:"This script is Copyright (C) 2022-2023 and is owned by Tenable, Inc. or an Affiliate thereof.");

  script_dependencies("palo_alto_globalprotect_agent_win_installed.nbin", "palo_alto_globalprotect_agent_mac_installed.nbin");
  script_require_keys("installed_sw/Palo Alto GlobalProtect Agent");

  exit(0);
}

include('vcf.inc');

var win_local = FALSE;
if (get_kb_item("SMB/Registry/Enumerated")) win_local = TRUE;

var app_info = vcf::get_app_info(app:'Palo Alto GlobalProtect Agent', win_local:win_local);

vcf::check_granularity(app_info:app_info, sig_segments:3);

var constraints = [
    { 'min_version' : '5.1', 'fixed_version' : '5.1.11' },
    { 'min_version' : '5.2', 'fixed_version' : '5.2.12' },
    { 'min_version' : '5.3', 'fixed_version' : '5.3.4' },
    { 'min_version' : '6.0', 'fixed_version' : '6.0.1' },
  ];

vcf::check_version_and_report(app_info:app_info, constraints:constraints, severity:SECURITY_WARNING);
