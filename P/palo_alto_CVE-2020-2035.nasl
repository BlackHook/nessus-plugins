#
# (C) Tenable Network Security, Inc.
#

include('compat.inc');

if (description)
{
  script_id(141350);
  script_version("1.3");
  script_set_attribute(attribute:"plugin_modification_date", value:"2020/10/13");

  script_cve_id("CVE-2020-2035");

  script_name(english:"Palo Alto Networks PAN-OS 8.1.x / 9.0.x / 9.1.x / 10.0.x Improper Input Validation");

  script_set_attribute(attribute:"synopsis", value:
"The remote PAN-OS host is affected by a vulnerability");
  script_set_attribute(attribute:"description", value:
"The version of Palo Alto Networks PAN-OS running on the remote host is 8.1.x or 9.0.x or 9.1.x or 10.0.x.
It is, therefore, affected by a improper input validation vulnerability.

  - When SSL/TLS Forward Proxy Decryption mode has been configured to decrypt the web transactions, the PAN-OS
    URL filtering feature inspects the HTTP Host and URL path headers for policy enforcement on the decrypted
    HTTPS web transactions but does not consider Server Name Indication (SNI) field within the TLS Client
    Hello handshake. This allows a compromised host in a protected network to evade any security policy that
    uses URL filtering on a firewall configured with SSL Decryption in the Forward Proxy mode. A malicious
    actor can then use this technique to evade detection of communication on the TLS handshake phase between a
    compromised host and a remote malicious server. This technique does not increase the risk of a host being
    compromised in the network. It does not impact the confidentiality or availability of a firewall. This is
    considered to have a low impact on the integrity of the firewall because the firewall fails to enforce a
    policy on certain traffic that should have been blocked. This issue does not impact the URL filtering
    policy enforcement on clear text or encrypted web transactions. This technique can be used only after a
    malicious actor has compromised a host in the protected network and the TLS/SSL Decryption feature is
    enabled for the traffic that the attacker controls. Palo Alto Networks is not aware of any malware that
    uses this technique to exfiltrate data. This issue is applicable to all current versions of PAN-OS.
    (CVE-2020-2035)

Note that Nessus has not tested for this issue but has instead relied only on the application's self-reported version
number.");
  script_set_attribute(attribute:"see_also", value:"https://security.paloaltonetworks.com/CVE-2020-2035");
  script_set_attribute(attribute:"see_also", value:"https://www.mnemonic.no/blog/introducing-snicat/");
  script_set_attribute(attribute:"see_also", value:"https://cwe.mitre.org/data/definitions/20.html");
  script_set_attribute(attribute:"solution", value:
"No updates currently available. Refer to vendor advisory for workaround details.");
  script_set_cvss_base_vector("CVSS2#AV:N/AC:M/Au:S/C:N/I:P/A:N");
  script_set_cvss_temporal_vector("CVSS2#E:U/RL:OF/RC:C");
  script_set_cvss3_base_vector("CVSS:3.0/AV:N/AC:H/PR:H/UI:N/S:C/C:N/I:L/A:N");
  script_set_cvss3_temporal_vector("CVSS:3.0/E:U/RL:O/RC:C");
  script_set_attribute(attribute:"cvss_score_source", value:"CVE-2020-2035");

  script_set_attribute(attribute:"exploitability_ease", value:"No known exploits are available");
  script_cwe_id(20);

  script_set_attribute(attribute:"vuln_publication_date", value:"2020/08/12");
  script_set_attribute(attribute:"patch_publication_date", value:"2020/08/12");
  script_set_attribute(attribute:"plugin_publication_date", value:"2020/10/09");

  script_set_attribute(attribute:"plugin_type", value:"combined");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:paloaltonetworks:pan-os");
  script_end_attributes();

  script_category(ACT_GATHER_INFO);
  script_family(english:"Palo Alto Local Security Checks");

  script_copyright(english:"This script is Copyright (C) 2020 and is owned by Tenable, Inc. or an Affiliate thereof.");

  script_dependencies("palo_alto_version.nbin");
  script_require_keys("Host/Palo_Alto/Firewall/Version", "Host/Palo_Alto/Firewall/Full_Version", "Host/Palo_Alto/Firewall/Source");

  exit(0);
}

include('vcf.inc');
include('vcf_extras.inc');

vcf::palo_alto::initialize();

app_name = 'Palo Alto Networks PAN-OS';

app_info = vcf::get_app_info(app:app_name, kb_ver:'Host/Palo_Alto/Firewall/Full_Version', kb_source:'Host/Palo_Alto/Firewall/Source');

constraints = [
  { 'min_version' : '8.1.0', 'fixed_display' : 'Please refer to vendor advisory.' },
  { 'min_version' : '9.0.0', 'fixed_display' : 'Please refer to vendor advisory.' },
  { 'min_version' : '9.1.0', 'fixed_display' : 'Please refer to vendor advisory.' },
  { 'min_version' : '10.0.0', 'fixed_display' : 'Please refer to vendor advisory.' }
];

vcf::check_version_and_report(
  app_info:app_info,
  constraints:constraints,
  severity:SECURITY_NOTE
);

