#
# (C) Tenable Network Security, Inc.
#

include('compat.inc');

if (description)
{
  script_id(138525);
  script_version("1.4");
  script_set_attribute(attribute:"plugin_modification_date", value:"2021/10/25");

  script_cve_id("CVE-2019-6470");
  script_xref(name:"IAVB", value:"2020-B-0036-S");

  script_name(english:"ISC DHCP < 4.4.1 DoS");

  script_set_attribute(attribute:"synopsis", value:
"The DHCP server installed on the remote Linux host is affected by a denial of service vulnerability.");
  script_set_attribute(attribute:"description", value:
"The DHCP server version installed on the remote host is prior to 4.4.1. It is, therefore, vulnerable to a denial of
service condition. There had existed in one of the ISC BIND libraries a bug in a function that was used by dhcpd when
operating in DHCPv6 mode. There was also a bug in dhcpd relating to the use of this function per its documentation, but
the bug in the library function prevented this from causing any harm. All releases of dhcpd from ISC contain copies of 
this, and other, BIND libraries in combinations that have been tested prior to release and are known to not present
issues like this. Some third-party packagers of ISC software have modified the dhcpd source, BIND source, or version
matchup in ways that create the crash potential. Based on reports available to ISC, the crash probability is large and
no analysis has been done on how, or even if, the probability can be manipulated by an attacker. Affects: Builds of
dhcpd versions prior to version 4.4.1 when using BIND versions 9.11.2 or later, or BIND versions with specific bug fixes
backported to them. ISC does not have access to comprehensive version lists for all repackagings of dhcpd that are
vulnerable. In particular, builds from other vendors may also be affected. Operators are advised to consult their vendor
documentation.

Note that Nessus has not tested for this issue but has instead relied only on the application's self-reported version 
number.");
  script_set_attribute(attribute:"solution", value:
"Upgrade the affected DHCP server to version 4.4.1 or later.");
  script_set_attribute(attribute:"agent", value:"unix");
  script_set_cvss_base_vector("CVSS2#AV:N/AC:L/Au:N/C:N/I:N/A:P");
  script_set_cvss_temporal_vector("CVSS2#E:U/RL:OF/RC:C");
  script_set_cvss3_base_vector("CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H");
  script_set_cvss3_temporal_vector("CVSS:3.0/E:U/RL:O/RC:C");
  script_set_attribute(attribute:"cvss_score_source", value:"CVE-2019-6470");

  script_set_attribute(attribute:"exploitability_ease", value:"No known exploits are available");

  script_set_attribute(attribute:"vuln_publication_date", value:"2019/11/01");
  script_set_attribute(attribute:"patch_publication_date", value:"2019/11/01");
  script_set_attribute(attribute:"plugin_publication_date", value:"2020/07/16");

  script_set_attribute(attribute:"plugin_type", value:"local");
  script_set_attribute(attribute:"cpe", value:"cpe:/a:isc:dhcp");
  script_set_attribute(attribute:"cpe", value:"cpe:/a:isc:bind");
  script_set_attribute(attribute:"stig_severity", value:"I");
  script_end_attributes();

  script_category(ACT_GATHER_INFO);
  script_family(english:"Misc.");

  script_copyright(english:"This script is Copyright (C) 2020-2021 and is owned by Tenable, Inc. or an Affiliate thereof.");

  script_dependencies("dhcp_detect.nbin");
  script_require_keys("dhcp_server/type", "dhcp_server/version");

  exit(0);
}

app = 'ISC DHCP';
fix = '4.4.1';

type = get_kb_item_or_exit('dhcp_server/type');
if ('isc-dhcp' >!< type) audit(AUDIT_NOT_INST, app);

version = get_kb_item_or_exit('dhcp_server/version');

if (version =~ "^[0-9]+\.[0-9]+$")
  audit(AUDIT_VER_NOT_GRANULAR, app, version);

if (report_paranoia < 2) audit(AUDIT_PARANOID);

if (ver_compare(fix:fix, ver:version, strict:FALSE) < 0)
{
  report = '\n  Installed version : ' + version + '\n';
  security_report_v4(severity:SECURITY_WARNING, port:0, extra:report);
}
else audit(AUDIT_INST_VER_NOT_VULN, app, version);
