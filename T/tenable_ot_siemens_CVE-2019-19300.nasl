##
# (C) Tenable, Inc.
##

include('compat.inc');

if (description)
{
  script_id(500363);
  script_version("1.3");
  script_set_attribute(attribute:"plugin_modification_date", value:"2023/02/22");

  script_cve_id("CVE-2019-19300");

  script_name(english:"Siemens (CVE-2019-19300)");

  script_set_attribute(attribute:"synopsis", value:
"The remote OT asset is affected by a vulnerability.");
  script_set_attribute(attribute:"description", value:
"A vulnerability has been identified in Development/Evaluation Kits for
PROFINET IO: EK-ERTEC 200 (All versions), Development/Evaluation Kits
for PROFINET IO: EK-ERTEC 200P (All versions), KTK ATE530S (All
versions), SIDOOR ATD430W (All versions), SIDOOR ATE530S COATED (All
versions), SIDOOR ATE531S (All versions), SIMATIC ET 200SP Open
Controller CPU 1515SP PC (incl. SIPLUS variants) (All versions <
V2.0), SIMATIC ET 200SP Open Controller CPU 1515SP PC2 (incl. SIPLUS
variants) (All versions < V2.0), SIMATIC ET200AL IM157-1 PN (All
versions), SIMATIC ET200ecoPN, CM 8x IO-Link, M12-L (All versions >=
V5.1.1), SIMATIC ET200ecoPN, DI 16x24VDC, M12-L (All versions >=
V5.1.1), SIMATIC ET200ecoPN, DI 8x24VDC, M12-L (All versions >=
V5.1.1), SIMATIC ET200ecoPN, DIQ 16x24VDC/2A, M12-L (All versions >=
V5.1.1), SIMATIC ET200ecoPN, DQ 8x24VDC/0,5A, M12-L (All versions >=
V5.1.1), SIMATIC ET200ecoPN, DQ 8x24VDC/2A, M12-L (All versions >=
V5.1.1), SIMATIC ET200MP IM155-5 PN HF (incl. SIPLUS variants) (All
versions >= V4.2), SIMATIC ET200SP IM155-6 MF HF (All versions),
SIMATIC ET200SP IM155-6 PN HA (incl. SIPLUS variants) (All versions),
SIMATIC ET200SP IM155-6 PN HF (incl. SIPLUS variants) (All versions >=
V4.2), SIMATIC ET200SP IM155-6 PN/2 HF (incl. SIPLUS variants) (All
versions >= V4.2), SIMATIC ET200SP IM155-6 PN/3 HF (incl. SIPLUS
variants) (All versions >= V4.2), SIMATIC MICRO-DRIVE PDC (All
versions), SIMATIC PN/MF Coupler (All versions), SIMATIC PN/PN Coupler
(incl. SIPLUS NET variants) (All versions >= V4.2), SIMATIC S7-1200
CPU family (incl. SIPLUS variants) (All versions < V4.4.0), SIMATIC
S7-1500 CPU family (incl. related ET200 CPUs and SIPLUS variants) (All
versions < V2.0), SIMATIC S7-1500 Software Controller (All versions <
V2.0), SIMATIC S7-300 CPU family (incl. related ET200 CPUs and SIPLUS
variants) (All versions), SIMATIC S7-400 H V6 CPU family and below
(incl. SIPLUS variants) (All versions), SIMATIC S7-400 PN/DP V7 CPU
family (incl. SIPLUS variants) (All versions), SIMATIC S7-410 V10 CPU
family (incl. SIPLUS variants) (All versions), SIMATIC S7-410 V8 CPU
family (incl. SIPLUS variants) (All versions), SIMATIC TDC CP51M1 (All
versions), SIMATIC TDC CPU555 (All versions), SIMATIC WinAC RTX 2010
(All versions), SIMATIC WinAC RTX F 2010 (All versions), SINAMICS S/G
Control Unit w. PROFINET (All versions). The Interniche-based TCP
Stack can be forced to make very expensive calls for every incoming
packet which can lead to a denial of service.

This plugin only works with Tenable.ot.
Please visit https://www.tenable.com/products/tenable-ot for more information.");
  script_set_attribute(attribute:"see_also", value:"https://cert-portal.siemens.com/productcert/pdf/ssa-593272.pdf");
  script_set_attribute(attribute:"solution", value:
"Refer to the vendor advisory.");
  script_set_cvss_base_vector("CVSS2#AV:N/AC:L/Au:N/C:N/I:N/A:P");
  script_set_cvss3_base_vector("CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H");
  script_set_attribute(attribute:"cvss_score_source", value:"CVE-2019-19300");

  script_set_attribute(attribute:"exploitability_ease", value:"No known exploits are available");
  script_cwe_id(400);

  script_set_attribute(attribute:"vuln_publication_date", value:"2020/04/14");
  script_set_attribute(attribute:"patch_publication_date", value:"2020/04/14");
  script_set_attribute(attribute:"plugin_publication_date", value:"2022/02/07");

  script_set_attribute(attribute:"plugin_type", value:"remote");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_et200mp_im155-5_pn_hf_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_et200sp_im155-6_mf_hf_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_et200sp_im155-6_pn%2f2_hf_firmware:4");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_et200sp_im155-6_pn_ha_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_et200sp_im155-6_pn_hf_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_et_200sp_open_controller_cpu_1515sp_pc2_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_et_200sp_open_controller_cpu_1515sp_pc_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7-1500_cpu_1511-1_pn_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7-1500_cpu_1511f-1_pn_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7-1500_cpu_1513-1_pn_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7-1500_cpu_1513f-1_pn_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7-1500_cpu_1515-2_pn_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7-1500_cpu_1515f-2_pn_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7-1500_cpu_1516-3_pn%2fdp_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7-1500_cpu_1516f-3_pn%2fdp_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7-1500_cpu_1517-3_pn%2fdp_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7-1500_cpu_1517f-3_pn%2fdp_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7-1500_cpu_1518-4_pn%2fdp_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7-1500_cpu_1518f-4_pn%2fdp_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7-300_cpu_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7-400_pn%2fdp_firmware");
  script_end_attributes();

  script_category(ACT_GATHER_INFO);
  script_family(english:"Tenable.ot");

  script_copyright(english:"This script is Copyright (C) 2022-2023 and is owned by Tenable, Inc. or an Affiliate thereof.");

  script_dependencies("tenable_ot_api_integration.nasl");
  script_require_keys("Tenable.ot/Siemens");

  exit(0);
}


include('tenable_ot_cve_funcs.inc');

get_kb_item_or_exit('Tenable.ot/Siemens');

var asset = tenable_ot::assets::get(vendor:'Siemens');

var vuln_cpes = {
    "cpe:/o:siemens:simatic_et_200sp_open_controller_cpu_1515sp_pc_firmware" :
        {"versionEndExcluding" : "2.0", "family" : "ET200SP"},
    "cpe:/o:siemens:simatic_et_200sp_open_controller_cpu_1515sp_pc2_firmware" :
        {"versionEndExcluding" : "2.0", "family" : "ET200SP"},
    "cpe:/o:siemens:simatic_et200mp_im155-5_pn_hf_firmware" :
        {"versionEndIncluding" : "4.2", "family" : "ET200"},
    "cpe:/o:siemens:simatic_et200sp_im155-6_mf_hf_firmware" :
        {"family" : "ET200SP"},
    "cpe:/o:siemens:simatic_et200sp_im155-6_pn_ha_firmware" :
        {"family" : "ET200SP"},
    "cpe:/o:siemens:simatic_et200sp_im155-6_pn_hf_firmware" :
        {"versionEndIncluding" : "4.2", "family" : "ET200SP"},
    "cpe:/o:siemens:simatic_et200sp_im155-6_pn%2f2_hf_firmware:4" :
        {"versionEndIncluding" : "4.2", "family" : "ET200SP"},
    "cpe:/o:siemens:simatic_et200sp_im155-6_pn%2f2_hf_firmware:4" :
        {"versionEndIncluding" : "4.2", "family" : "ET200SP"},
    "cpe:/o:siemens:simatic_s7-1500_cpu_1511-1_pn_firmware" :
        {"versionEndExcluding" : "2.0", "family" : "S71500"},
    "cpe:/o:siemens:simatic_s7-1500_cpu_1513-1_pn_firmware" :
        {"versionEndExcluding" : "2.0", "family" : "S71500"},
    "cpe:/o:siemens:simatic_s7-1500_cpu_1515-2_pn_firmware" :
        {"versionEndExcluding" : "2.0", "family" : "S71500"},
    "cpe:/o:siemens:simatic_s7-1500_cpu_1516-3_pn%2fdp_firmware" :
        {"versionEndExcluding" : "2.0", "family" : "S71500"},
    "cpe:/o:siemens:simatic_s7-1500_cpu_1517-3_pn%2fdp_firmware" :
        {"versionEndExcluding" : "2.0", "family" : "S71500"},
    "cpe:/o:siemens:simatic_s7-1500_cpu_1518-4_pn%2fdp_firmware" :
        {"versionEndExcluding" : "2.0", "family" : "S71500"},
    "cpe:/o:siemens:simatic_s7-1500_cpu_1511f-1_pn_firmware" :
        {"versionEndExcluding" : "2.0", "family" : "S71500"},
    "cpe:/o:siemens:simatic_s7-1500_cpu_1513f-1_pn_firmware" :
        {"versionEndExcluding" : "2.0", "family" : "S71500"},
    "cpe:/o:siemens:simatic_s7-1500_cpu_1515f-2_pn_firmware" :
        {"versionEndExcluding" : "2.0", "family" : "S71500"},
    "cpe:/o:siemens:simatic_s7-1500_cpu_1516f-3_pn%2fdp_firmware" :
        {"versionEndExcluding" : "2.0", "family" : "S71500"},
    "cpe:/o:siemens:simatic_s7-1500_cpu_1517f-3_pn%2fdp_firmware" :
        {"versionEndExcluding" : "2.0", "family" : "S71500"},
    "cpe:/o:siemens:simatic_s7-1500_cpu_1518f-4_pn%2fdp_firmware" :
        {"versionEndExcluding" : "2.0", "family" : "S71500"},
    "cpe:/o:siemens:simatic_s7-300_cpu_firmware" :
        {"family" : "S7300"},
    "cpe:/o:siemens:simatic_s7-400_pn%2fdp_firmware" :
        {"family" : "S7400"}
};

tenable_ot::cve::compare_and_report(asset:asset, cpes:vuln_cpes, severity:SECURITY_WARNING);
