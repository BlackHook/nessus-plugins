#%NASL_MIN_LEVEL 70300
##
# (C) Tenable Network Security, Inc.
##

include('deprecated_nasl_level.inc');
include('compat.inc');

if (description)
{
  script_id(500355);
  script_version("1.2");
  script_set_attribute(attribute:"plugin_modification_date", value:"2023/04/18");

  script_cve_id("CVE-2019-13945");

  script_name(english:"Siemens (CVE-2019-13945)");

  script_set_attribute(attribute:"synopsis", value:
"The remote OT asset is affected by a vulnerability.");
  script_set_attribute(attribute:"description", value:
"A vulnerability has been identified in SIMATIC S7-1200 CPU family (incl. SIPLUS variants) (All versions), SIMATIC
S7-1200 CPU family < V4.x (incl. SIPLUS variants) (All versions), SIMATIC S7-1200 CPU family V4.x (incl. SIPLUS
variants) (All versions with Function State (FS) < 11), SIMATIC S7-200 SMART CPU CR20s (6ES7 288-1CR20-0AA1) (All
versions <= V2.3.0 and Function State (FS) <= 3), SIMATIC S7-200 SMART CPU CR30s (6ES7 288-1CR30-0AA1) (All versions <=
V2.3.0 and Function State (FS) <= 3), SIMATIC S7-200 SMART CPU CR40 (6ES7 288-1CR40-0AA0) (All versions <= V2.2.2 and
Function State (FS) <= 8), SIMATIC S7-200 SMART CPU CR40s (6ES7 288-1CR40-0AA1) (All versions <= V2.3.0 and Function
State (FS) <= 3), SIMATIC S7-200 SMART CPU CR60 (6ES7 288-1CR60-0AA0) (All versions <= V2.2.2 and Function State (FS) <=
10), SIMATIC S7-200 SMART CPU CR60s (6ES7 288-1CR60-0AA1) (All versions <= V2.3.0 and Function State (FS) <= 3), SIMATIC
S7-200 SMART CPU SR20 (6ES7 288-1SR20-0AA0) (All versions <= V2.5.0 and Function State (FS) <= 11), SIMATIC S7-200 SMART
CPU SR30 (6ES7 288-1SR30-0AA0) (All versions <= V2.5.0 and Function State (FS) <= 10), SIMATIC S7-200 SMART CPU SR40
(6ES7 288-1SR40-0AA0) (All versions <= V2.5.0 and Function State (FS) <= 10), SIMATIC S7-200 SMART CPU SR60 (6ES7
288-1SR60-0AA0) (All versions <= V2.5.0 and Function State (FS) <= 12), SIMATIC S7-200 SMART CPU ST20 (6ES7
288-1ST20-0AA0) (All versions <= V2.5.0 and Function State (FS) <= 9), SIMATIC S7-200 SMART CPU ST30 (6ES7
288-1ST30-0AA0) (All versions <= V2.5.0 and Function State (FS) <= 9), SIMATIC S7-200 SMART CPU ST40 (6ES7
288-1ST40-0AA0) (All versions <= V2.5.0 and Function State (FS) <= 8), SIMATIC S7-200 SMART CPU ST60 (6ES7
288-1ST60-0AA0) (All versions <= V2.5.0 and Function State (FS) <= 8), SIMATIC S7-200 SMART CPU family (All versions).
There is an access mode used during manufacturing of the affected devices that allows additional diagnostic
functionality. The security vulnerability could be exploited by an attacker with physical access to the UART interface
during boot process.  

This plugin only works with Tenable.ot. Please visit https://www.tenable.com/products/tenable-ot
for more information.");
  script_set_attribute(attribute:"see_also", value:"https://cert-portal.siemens.com/productcert/pdf/ssa-686531.pdf");
  script_set_attribute(attribute:"solution", value:
"Refer to the vendor advisory.");
  script_set_cvss_base_vector("CVSS2#AV:L/AC:L/Au:N/C:P/I:P/A:P");
  script_set_cvss3_base_vector("CVSS:3.0/AV:P/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H");
  script_set_attribute(attribute:"cvss_score_source", value:"CVE-2019-13945");

  script_set_attribute(attribute:"exploitability_ease", value:"No known exploits are available");

  script_set_attribute(attribute:"vuln_publication_date", value:"2019/12/12");
  script_set_attribute(attribute:"patch_publication_date", value:"2019/12/12");
  script_set_attribute(attribute:"plugin_publication_date", value:"2022/02/07");

  script_set_attribute(attribute:"plugin_type", value:"remote");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7-1200_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:s7-200_smart_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7-200_smart_cpu_st20_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7-200_smart_cpu_st30_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7-200_smart_cpu_st40_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7-200_smart_cpu_st60_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7-200_smart_cpu_sr20_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7-200_smart_cpu_sr30_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7-200_smart_cpu_sr40_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7-200_smart_cpu_sr60_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7-200_smart_cpu_cr40_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7-200_smart_cpu_cr60_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7-200_smart_cpu_cr20s_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7-200_smart_cpu_cr30s_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7-200_smart_cpu_cr40s_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7-200_smart_cpu_cr60s_firmware");
  script_end_attributes();

  script_category(ACT_GATHER_INFO);
  script_family(english:"Tenable.ot");

  script_copyright(english:"This script is Copyright (C) 2022-2023 and is owned by Tenable, Inc. or an Affiliate thereof.");

  script_dependencies("tenable_ot_api_integration.nasl");
  script_require_keys("Tenable.ot/Siemens");

  exit(0);
}


include('tenable_ot_cve_funcs.inc');

get_kb_item_or_exit('Tenable.ot/Siemens');

var asset = tenable_ot::assets::get(vendor:'Siemens');

var vuln_cpes = {
    "cpe:/o:siemens:simatic_s7-1200_firmware" :
        {"family" : "S71200"},
    "cpe:/o:siemens:s7-200_smart_firmware" :
        {"family" : "S7200"},
    "cpe:/o:siemens:simatic_s7-200_smart_cpu_st20_firmware" :
        {"versionEndIncluding" : "2.5.0", "family" : "S7200"},
    "cpe:/o:siemens:simatic_s7-200_smart_cpu_st30_firmware" :
        {"versionEndIncluding" : "2.5.0", "family" : "S7200"},
    "cpe:/o:siemens:simatic_s7-200_smart_cpu_st40_firmware" :
        {"versionEndIncluding" : "2.5.0", "family" : "S7200"},
    "cpe:/o:siemens:simatic_s7-200_smart_cpu_st60_firmware" :
        {"versionEndIncluding" : "2.5.0", "family" : "S7200"},
    "cpe:/o:siemens:simatic_s7-200_smart_cpu_sr20_firmware" :
        {"versionEndIncluding" : "2.5.0", "family" : "S7200"},
    "cpe:/o:siemens:simatic_s7-200_smart_cpu_sr30_firmware" :
        {"versionEndIncluding" : "2.5.0", "family" : "S7200"},
    "cpe:/o:siemens:simatic_s7-200_smart_cpu_sr40_firmware" :
        {"versionEndIncluding" : "2.5.0", "family" : "S7200"},
    "cpe:/o:siemens:simatic_s7-200_smart_cpu_sr60_firmware" :
        {"versionEndIncluding" : "2.5.0", "family" : "S7200"},
    "cpe:/o:siemens:simatic_s7-200_smart_cpu_cr40_firmware" :
        {"versionEndIncluding" : "2.2.2", "family" : "S7200"},
    "cpe:/o:siemens:simatic_s7-200_smart_cpu_cr60_firmware" :
        {"versionEndIncluding" : "2.2.2", "family" : "S7200"},
    "cpe:/o:siemens:simatic_s7-200_smart_cpu_cr20s_firmware" :
        {"versionEndIncluding" : "2.3.0", "family" : "S7200"},
    "cpe:/o:siemens:simatic_s7-200_smart_cpu_cr30s_firmware" :
        {"versionEndIncluding" : "2.3.0", "family" : "S7200"},
    "cpe:/o:siemens:simatic_s7-200_smart_cpu_cr40s_firmware" :
        {"versionEndIncluding" : "2.3.0", "family" : "S7200"},
    "cpe:/o:siemens:simatic_s7-200_smart_cpu_cr60s_firmware" :
        {"versionEndIncluding" : "2.3.0", "family" : "S7200"}
};

tenable_ot::cve::compare_and_report(asset:asset, cpes:vuln_cpes, severity:SECURITY_WARNING);
