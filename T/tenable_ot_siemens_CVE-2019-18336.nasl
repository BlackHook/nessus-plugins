#%NASL_MIN_LEVEL 70300
##
# (C) Tenable Network Security, Inc.
##

include('deprecated_nasl_level.inc');
include('compat.inc');

if (description)
{
  script_id(500360);
  script_version("1.3");
  script_set_attribute(attribute:"plugin_modification_date", value:"2023/05/30");

  script_cve_id("CVE-2019-18336");

  script_name(english:"Siemens (CVE-2019-18336)");

  script_set_attribute(attribute:"synopsis", value:
"The remote OT asset is affected by a vulnerability.");
  script_set_attribute(attribute:"description", value:
"A vulnerability has been identified in SIMATIC S7-300 CPU family (incl. related ET200 CPUs and SIPLUS variants) (All
versions < V3.X.17), SIMATIC TDC CP51M1 (All versions < V1.1.8), SIMATIC TDC CPU555 (All versions < V1.1.1), SINUMERIK
840D sl (All versions < V4.8.6), SINUMERIK 840D sl (All versions < V4.94). Specially crafted packets sent to port
102/tcp (Profinet) could cause the affected device to go into defect mode. A restart is required in order to recover the
system. Successful exploitation requires an attacker to have network access to port 102/tcp, with no authentication. No
user interation is required. At the time of advisory publication no public exploitation of this security vulnerability
was known.  

This plugin only works with Tenable.ot. Please visit https://www.tenable.com/products/tenable-ot for more
information.");
  script_set_attribute(attribute:"see_also", value:"https://cert-portal.siemens.com/productcert/pdf/ssa-508982.pdf");
  script_set_attribute(attribute:"solution", value:
"Refer to the vendor advisory.");
  script_set_cvss_base_vector("CVSS2#AV:N/AC:L/Au:N/C:N/I:N/A:C");
  script_set_cvss3_base_vector("CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H");
  script_set_attribute(attribute:"cvss_score_source", value:"CVE-2019-18336");

  script_set_attribute(attribute:"exploitability_ease", value:"No known exploits are available");
  script_cwe_id(400);

  script_set_attribute(attribute:"vuln_publication_date", value:"2020/03/10");
  script_set_attribute(attribute:"patch_publication_date", value:"2020/03/10");
  script_set_attribute(attribute:"plugin_publication_date", value:"2022/02/07");

  script_set_attribute(attribute:"plugin_type", value:"remote");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7-300_cpu_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7-300_cpu_312_ifm_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7-300_cpu_313_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7-300_cpu_314_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7-300_cpu_314_ifm_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7-300_cpu_315_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7-300_cpu_315-2_dp_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7-300_cpu_316-2_dp_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7-300_cpu_318-2_firmware");
  script_set_attribute(attribute:"generated_plugin", value:"former");
  script_end_attributes();

  script_category(ACT_GATHER_INFO);
  script_family(english:"Tenable.ot");

  script_copyright(english:"This script is Copyright (C) 2022-2023 and is owned by Tenable, Inc. or an Affiliate thereof.");

  script_dependencies("tenable_ot_api_integration.nasl");
  script_require_keys("Tenable.ot/Siemens");

  exit(0);
}


include('tenable_ot_cve_funcs.inc');

get_kb_item_or_exit('Tenable.ot/Siemens');

var asset = tenable_ot::assets::get(vendor:'Siemens');

var vuln_cpes = {
    "cpe:/o:siemens:simatic_s7-300_cpu_firmware" :
        {"versionEndExcluding" : "3.0.17", "family" : "S7300"},
    "cpe:/o:siemens:simatic_s7-300_cpu_firmware:3.1" :
        {"versionStartIncluding" : "3.1.0", "versionEndExcluding" : "3.1.17", "family" : "S7300"},
    "cpe:/o:siemens:simatic_s7-300_cpu_firmware:3.2" :
        {"versionStartIncluding" : "3.2.0", "versionEndExcluding" : "3.2.17", "family" : "S7300"},
    "cpe:/o:siemens:simatic_s7-300_cpu_firmware:3.3" :
        {"versionStartIncluding" : "3.3.0", "versionEndExcluding" : "3.3.17", "family" : "S7300"},
    "cpe:/o:siemens:simatic_s7-300_cpu_312_ifm_firmware" :
        {"versionEndExcluding" : "3.0.17", "family" : "S7300"},
    "cpe:/o:siemens:simatic_s7-300_cpu_312_ifm_firmware:3.1" :
        {"versionStartIncluding" : "3.1.0", "versionEndExcluding" : "3.1.17", "family" : "S7300"},
    "cpe:/o:siemens:simatic_s7-300_cpu_312_ifm_firmware:3.2" :
        {"versionStartIncluding" : "3.2.0", "versionEndExcluding" : "3.2.17", "family" : "S7300"},
    "cpe:/o:siemens:simatic_s7-300_cpu_312_ifm_firmware:3.3" :
        {"versionStartIncluding" : "3.3.0", "versionEndExcluding" : "3.3.17", "family" : "S7300"},
    "cpe:/o:siemens:simatic_s7-300_cpu_313_firmware" :
        {"versionEndExcluding" : "3.0.17", "family" : "S7300"},
    "cpe:/o:siemens:simatic_s7-300_cpu_313_firmware:3.1" :
        {"versionStartIncluding" : "3.1.0", "versionEndExcluding" : "3.1.17", "family" : "S7300"},
    "cpe:/o:siemens:simatic_s7-300_cpu_313_firmware:3.2" :
        {"versionStartIncluding" : "3.2.0", "versionEndExcluding" : "3.2.17", "family" : "S7300"},
    "cpe:/o:siemens:simatic_s7-300_cpu_313_firmware:3.3" :
        {"versionStartIncluding" : "3.3.0", "versionEndExcluding" : "3.3.17", "family" : "S7300"},
    "cpe:/o:siemens:simatic_s7-300_cpu_314_firmware" :
        {"versionEndExcluding" : "3.0.17", "family" : "S7300"},
    "cpe:/o:siemens:simatic_s7-300_cpu_314_firmware:3.1" :
        {"versionStartIncluding" : "3.1.0", "versionEndExcluding" : "3.1.17", "family" : "S7300"},
    "cpe:/o:siemens:simatic_s7-300_cpu_314_firmware:3.2" :
        {"versionStartIncluding" : "3.2.0", "versionEndExcluding" : "3.2.17", "family" : "S7300"},
    "cpe:/o:siemens:simatic_s7-300_cpu_314_firmware:3.3" :
        {"versionStartIncluding" : "3.3.0", "versionEndExcluding" : "3.3.17", "family" : "S7300"},
    "cpe:/o:siemens:simatic_s7-300_cpu_314_ifm_firmware" :
        {"versionEndExcluding" : "3.0.17", "family" : "S7300"},
    "cpe:/o:siemens:simatic_s7-300_cpu_314_ifm_firmware:3.1" :
        {"versionStartIncluding" : "3.1.0", "versionEndExcluding" : "3.1.17", "family" : "S7300"},
    "cpe:/o:siemens:simatic_s7-300_cpu_314_ifm_firmware:3.2" :
        {"versionStartIncluding" : "3.2.0", "versionEndExcluding" : "3.2.17", "family" : "S7300"},
    "cpe:/o:siemens:simatic_s7-300_cpu_314_ifm_firmware:3.3" :
        {"versionStartIncluding" : "3.3.0", "versionEndExcluding" : "3.3.17", "family" : "S7300"},
    "cpe:/o:siemens:simatic_s7-300_cpu_315_firmware" :
        {"versionEndExcluding" : "3.0.17", "family" : "S7300"},
    "cpe:/o:siemens:simatic_s7-300_cpu_315_firmware:3.1" :
        {"versionStartIncluding" : "3.1.0", "versionEndExcluding" : "3.1.17", "family" : "S7300"},
    "cpe:/o:siemens:simatic_s7-300_cpu_315_firmware:3.2" :
        {"versionStartIncluding" : "3.2.0", "versionEndExcluding" : "3.2.17", "family" : "S7300"},
    "cpe:/o:siemens:simatic_s7-300_cpu_315_firmware:3.3" :
        {"versionStartIncluding" : "3.3.0", "versionEndExcluding" : "3.3.17", "family" : "S7300"},
    "cpe:/o:siemens:simatic_s7-300_cpu_315-2_dp_firmware" :
        {"versionEndExcluding" : "3.0.17", "family" : "S7300"},
    "cpe:/o:siemens:simatic_s7-300_cpu_315-2_dp_firmware:3.1" :
        {"versionStartIncluding" : "3.1.0", "versionEndExcluding" : "3.1.17", "family" : "S7300"},
    "cpe:/o:siemens:simatic_s7-300_cpu_315-2_dp_firmware:3.2" :
        {"versionStartIncluding" : "3.2.0", "versionEndExcluding" : "3.2.17", "family" : "S7300"},
    "cpe:/o:siemens:simatic_s7-300_cpu_315-2_dp_firmware:3.3" :
        {"versionStartIncluding" : "3.3.0", "versionEndExcluding" : "3.3.17", "family" : "S7300"},
    "cpe:/o:siemens:simatic_s7-300_cpu_316-2_dp_firmware" :
        {"versionEndExcluding" : "3.0.17", "family" : "S7300"},
    "cpe:/o:siemens:simatic_s7-300_cpu_316-2_dp_firmware:3.1" :
        {"versionStartIncluding" : "3.1.0", "versionEndExcluding" : "3.1.17", "family" : "S7300"},
    "cpe:/o:siemens:simatic_s7-300_cpu_316-2_dp_firmware:3.2" :
        {"versionStartIncluding" : "3.2.0", "versionEndExcluding" : "3.2.17", "family" : "S7300"},
    "cpe:/o:siemens:simatic_s7-300_cpu_316-2_dp_firmware:3.3" :
        {"versionStartIncluding" : "3.3.0", "versionEndExcluding" : "3.3.17", "family" : "S7300"},
    "cpe:/o:siemens:simatic_s7-300_cpu_318-2_firmware" :
        {"versionEndExcluding" : "3.0.17", "family" : "S7300"},
    "cpe:/o:siemens:simatic_s7-300_cpu_318-2_firmware:3.1" :
        {"versionStartIncluding" : "3.1.0", "versionEndExcluding" : "3.1.17", "family" : "S7300"},
    "cpe:/o:siemens:simatic_s7-300_cpu_318-2_firmware:3.2" :
        {"versionStartIncluding" : "3.2.0", "versionEndExcluding" : "3.2.17", "family" : "S7300"},
    "cpe:/o:siemens:simatic_s7-300_cpu_318-2_firmware:3.3" :
        {"versionStartIncluding" : "3.3.0", "versionEndExcluding" : "3.3.17", "family" : "S7300"}
};

tenable_ot::cve::compare_and_report(asset:asset, cpes:vuln_cpes, severity:SECURITY_HOLE);
