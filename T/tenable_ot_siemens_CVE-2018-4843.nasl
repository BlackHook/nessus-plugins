#%NASL_MIN_LEVEL 70300
##
# (C) Tenable, Inc.
##

include('deprecated_nasl_level.inc');
include('compat.inc');

if (description)
{
  script_id(500232);
  script_version("1.4");
  script_set_attribute(attribute:"plugin_modification_date", value:"2023/05/03");

  script_cve_id("CVE-2018-4843");

  script_name(english:"Siemens (CVE-2018-4843)");

  script_set_attribute(attribute:"synopsis", value:
"The remote OT asset is affected by a vulnerability.");
  script_set_attribute(attribute:"description", value:
"A vulnerability has been identified in SIMATIC CP 343-1 (incl. SIPLUS
variants) (All versions), SIMATIC CP 343-1 Advanced (incl. SIPLUS
variants) (All versions), SIMATIC CP 443-1 (All versions < V3.3),
SIMATIC CP 443-1 (All versions < V3.3), SIMATIC CP 443-1 Advanced (All
versions < V3.3), SIMATIC ET 200pro IM154-8 PN/DP CPU (All versions <
V3.2.16), SIMATIC ET 200pro IM154-8F PN/DP CPU (All versions <
V3.2.16), SIMATIC ET 200pro IM154-8FX PN/DP CPU (All versions <
V3.2.16), SIMATIC ET 200S IM151-8 PN/DP CPU (All versions < V3.2.16),
SIMATIC ET 200S IM151-8F PN/DP CPU (All versions < V3.2.16), SIMATIC
S7-1500 CPU family (incl. related ET200 CPUs and SIPLUS variants) (All
versions < V1.7.0), SIMATIC S7-1500 Software Controller (All versions
< V1.7.0), SIMATIC S7-300 CPU 314C-2 PN/DP (All versions < V3.3.16),
SIMATIC S7-300 CPU 315-2 PN/DP (All versions < V3.2.16), SIMATIC
S7-300 CPU 315F-2 PN/DP (All versions < V3.2.16), SIMATIC S7-300 CPU
315T-3 PN/DP (All versions < V3.2.16), SIMATIC S7-300 CPU 317-2 PN/DP
(All versions < V3.2.16), SIMATIC S7-300 CPU 317F-2 PN/DP (All
versions < V3.2.16), SIMATIC S7-300 CPU 317T-3 PN/DP (All versions <
V3.2.16), SIMATIC S7-300 CPU 317TF-3 PN/DP (All versions < V3.2.16),
SIMATIC S7-300 CPU 319-3 PN/DP (All versions < V3.2.16), SIMATIC
S7-300 CPU 319F-3 PN/DP (All versions < V3.2.16), SIMATIC S7-400 H V6
CPU family (incl. SIPLUS variants) (All versions < V6.0.9), SIMATIC
S7-400 PN/DP V6 CPU family (incl. SIPLUS variants) (All versions <
V6.0.7), SIMATIC S7-400 PN/DP V7 CPU family (incl. SIPLUS variants)
(All versions), SIMATIC S7-410 CPU family (incl. SIPLUS variants) (All
versions < V8.1), SIMATIC WinAC RTX 2010 (All versions < V2010 SP3),
SIMATIC WinAC RTX F 2010 (All versions < V2010 SP3), SINUMERIK 828D
(All versions < V4.7 SP6 HF1), SIPLUS ET 200S IM151-8 PN/DP CPU (All
versions < V3.2.16), SIPLUS ET 200S IM151-8F PN/DP CPU (All versions <
V3.2.16), SIPLUS NET CP 443-1 (All versions < V3.3), SIPLUS NET CP
443-1 Advanced (All versions < V3.3), SIPLUS S7-300 CPU 314C-2 PN/DP
(All versions < V3.3.16), SIPLUS S7-300 CPU 315-2 PN/DP (All versions
< V3.2.16), SIPLUS S7-300 CPU 315F-2 PN/DP (All versions < V3.2.16),
SIPLUS S7-300 CPU 317-2 PN/DP (All versions < V3.2.16), SIPLUS S7-300
CPU 317F-2 PN/DP (All versions < V3.2.16), Softnet PROFINET IO for PC-
based Windows systems (All versions). Responding to a PROFINET DCP
request with a specially crafted PROFINET DCP packet could cause a
Denial-of-Service condition of the requesting system. The security
vulnerability could be exploited by an attacker located on the same
Ethernet segment (OSI Layer 2) as the targeted device. Successful
exploitation requires no user interaction or privileges and impacts
the availability of core functionality of the affected device. A
manual restart is required to recover the system. At the time of
advisory publication no public exploitation of this security
vulnerability is known. Siemens provides mitigations to resolve the
security issue. PROFIBUS interfaces are not affected.

This plugin only works with Tenable.ot.
Please visit https://www.tenable.com/products/tenable-ot for more information.");
  script_set_attribute(attribute:"see_also", value:"https://cert-portal.siemens.com/productcert/pdf/ssa-592007.pdf");
  script_set_attribute(attribute:"solution", value:
"Refer to the vendor advisory.");
  script_set_cvss_base_vector("CVSS2#AV:A/AC:L/Au:N/C:N/I:N/A:C");
  script_set_cvss3_base_vector("CVSS:3.0/AV:A/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H");
  script_set_attribute(attribute:"cvss_score_source", value:"CVE-2018-4843");

  script_set_attribute(attribute:"exploitability_ease", value:"No known exploits are available");
  script_cwe_id(20);

  script_set_attribute(attribute:"vuln_publication_date", value:"2018/03/20");
  script_set_attribute(attribute:"patch_publication_date", value:"2018/03/20");
  script_set_attribute(attribute:"plugin_publication_date", value:"2022/02/07");

  script_set_attribute(attribute:"plugin_type", value:"remote");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_cp_343-1_advanced_firmware:-");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_cp_343-1_standard_firmware:-");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_cp_443-1_advanced_firmware:-");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_cp_443-1_standard_firmware:-");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7-1500_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7-300_firmware:-");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7-400_h_v6_firmware:-");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7-400_pn%2fdp_v6_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7-400_pn%2fdp_v7_firmware:-");
  script_end_attributes();

  script_category(ACT_GATHER_INFO);
  script_family(english:"Tenable.ot");

  script_copyright(english:"This script is Copyright (C) 2022-2023 and is owned by Tenable, Inc. or an Affiliate thereof.");

  script_dependencies("tenable_ot_api_integration.nasl");
  script_require_keys("Tenable.ot/Siemens");

  exit(0);
}


include('tenable_ot_cve_funcs.inc');

get_kb_item_or_exit('Tenable.ot/Siemens');

var asset = tenable_ot::assets::get(vendor:'Siemens');

var vuln_cpes = {
    "cpe:/o:siemens:simatic_cp_343-1_advanced_firmware:-" :
        {"family" : "S7300"},
    "cpe:/o:siemens:simatic_cp_343-1_standard_firmware:-" :
        {"family" : "S7300"},
    "cpe:/o:siemens:simatic_cp_443-1_advanced_firmware:-" :
        {"family" : "S7400", "versionEndExcluding" : "3.3"},
    "cpe:/o:siemens:simatic_cp_443-1_standard_firmware:-" :
        {"family" : "S7400", "versionEndExcluding" : "3.3"},
    "cpe:/o:siemens:simatic_s7-1500_firmware" :
        {"versionEndExcluding" : "1.7.0", "family" : "S71500"},
    "cpe:/o:siemens:simatic_s7-300_firmware:-" :
        {"family" : "S7300"},
    "cpe:/o:siemens:simatic_s7-400_h_v6_firmware:-" :
        {"family" : "S7400"},
    "cpe:/o:siemens:simatic_s7-400_pn%2fdp_v6_firmware" :
        {"versionEndExcluding" : "6.0.7", "family" : "S7400"},
    "cpe:/o:siemens:simatic_s7-400_pn%2fdp_v7_firmware:-" :
        {"family" : "S7400"}
};

tenable_ot::cve::compare_and_report(asset:asset, cpes:vuln_cpes, severity:SECURITY_WARNING);
