#%NASL_MIN_LEVEL 70300
##
# (C) Tenable Network Security, Inc.
##

include('deprecated_nasl_level.inc');
include('compat.inc');

if (description)
{
  script_id(500588);
  script_version("1.2");
  script_set_attribute(attribute:"plugin_modification_date", value:"2023/04/18");

  script_cve_id("CVE-2020-16850");

  script_name(english:"Mitsubishi (CVE-2020-16850)");

  script_set_attribute(attribute:"synopsis", value:
"The remote OT asset is affected by a vulnerability.");
  script_set_attribute(attribute:"description", value:
"Mitsubishi MELSEC iQ-R Series PLCs with firmware 49 allow an unauthenticated attacker to halt the industrial process by
sending a crafted packet over the network. This denial of service attack exposes Improper Input Validation. After
halting, physical access to the PLC is required in order to restore production, and the device state is lost. This is
related to R04CPU, RJ71GF11-T2, R04CPU, and RJ71GF11-T2.  

This plugin only works with Tenable.ot. Please visit
https://www.tenable.com/products/tenable-ot for more information.");
  script_set_attribute(attribute:"see_also", value:"https://us-cert.cisa.gov/ics/advisories/icsa-20-282-02");
  # https://blog.scadafence.com/vulnerability-in-mitsubishi-electric-melsec-iq-r-series
  script_set_attribute(attribute:"see_also", value:"http://www.nessus.org/u?cff697a7");
  script_set_attribute(attribute:"solution", value:
"Refer to the vendor advisory.");
  script_set_cvss_base_vector("CVSS2#AV:N/AC:L/Au:N/C:N/I:N/A:C");
  script_set_cvss3_base_vector("CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H");
  script_set_attribute(attribute:"cvss_score_source", value:"CVE-2020-16850");

  script_set_attribute(attribute:"exploitability_ease", value:"No known exploits are available");
  script_cwe_id(20, 400);

  script_set_attribute(attribute:"vuln_publication_date", value:"2020/11/30");
  script_set_attribute(attribute:"patch_publication_date", value:"2020/11/30");
  script_set_attribute(attribute:"plugin_publication_date", value:"2022/02/07");

  script_set_attribute(attribute:"plugin_type", value:"remote");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:mitsubishielectric:r00cpu_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:mitsubishielectric:r01cpu_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:mitsubishielectric:r02cpu_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:mitsubishielectric:r04cpu_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:mitsubishielectric:r08cpu_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:mitsubishielectric:r16cpu_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:mitsubishielectric:r32cpu_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:mitsubishielectric:r120cpu_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:mitsubishielectric:r08sfcpu_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:mitsubishielectric:r16sfcpu_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:mitsubishielectric:r32sfcpu_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:mitsubishielectric:r120sfcpu_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:mitsubishielectric:r08pcpu_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:mitsubishielectric:r16pcpu_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:mitsubishielectric:r32pcpu_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:mitsubishielectric:r120pcpu_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:mitsubishielectric:r16mtcpu_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:mitsubishielectric:r32mtcpu_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:mitsubishielectric:r64mtcpu_firmware");
  script_end_attributes();

  script_category(ACT_GATHER_INFO);
  script_family(english:"Tenable.ot");

  script_copyright(english:"This script is Copyright (C) 2022-2023 and is owned by Tenable, Inc. or an Affiliate thereof.");

  script_dependencies("tenable_ot_api_integration.nasl");
  script_require_keys("Tenable.ot/Mitsubishi");

  exit(0);
}


include('tenable_ot_cve_funcs.inc');

get_kb_item_or_exit('Tenable.ot/Mitsubishi');

var asset = tenable_ot::assets::get(vendor:'Mitsubishi');

var vuln_cpes = {
    "cpe:/o:mitsubishielectric:r00cpu_firmware" :
        {"versionEndIncluding" : "20", "family" : "MELSECiQR"},
    "cpe:/o:mitsubishielectric:r01cpu_firmware" :
        {"versionEndIncluding" : "20", "family" : "MELSECiQR"},
    "cpe:/o:mitsubishielectric:r02cpu_firmware" :
        {"versionEndIncluding" : "20", "family" : "MELSECiQR"},
    "cpe:/o:mitsubishielectric:r04cpu_firmware" :
        {"versionEndIncluding" : "52", "family" : "MELSECiQR"},
    "cpe:/o:mitsubishielectric:r08cpu_firmware" :
        {"versionEndIncluding" : "52", "family" : "MELSECiQR"},
    "cpe:/o:mitsubishielectric:r16cpu_firmware" :
        {"versionEndIncluding" : "52", "family" : "MELSECiQR"},
    "cpe:/o:mitsubishielectric:r32cpu_firmware" :
        {"versionEndIncluding" : "52", "family" : "MELSECiQR"},
    "cpe:/o:mitsubishielectric:r120cpu_firmware" :
        {"versionEndIncluding" : "52", "family" : "MELSECiQR"},
    "cpe:/o:mitsubishielectric:r08sfcpu_firmware" :
        {"versionEndIncluding" : "22", "family" : "MELSECiQR"},
    "cpe:/o:mitsubishielectric:r16sfcpu_firmware" :
        {"versionEndIncluding" : "22", "family" : "MELSECiQR"},
    "cpe:/o:mitsubishielectric:r32sfcpu_firmware" :
        {"versionEndIncluding" : "22", "family" : "MELSECiQR"},
    "cpe:/o:mitsubishielectric:r120sfcpu_firmware" :
        {"versionEndIncluding" : "22", "family" : "MELSECiQR"},
    "cpe:/o:mitsubishielectric:r08pcpu_firmware" :
        {"family" : "MELSECiQR"},
    "cpe:/o:mitsubishielectric:r16pcpu_firmware" :
        {"family" : "MELSECiQR"},
    "cpe:/o:mitsubishielectric:r32pcpu_firmware" :
        {"family" : "MELSECiQR"},
    "cpe:/o:mitsubishielectric:r120pcpu_firmware" :
        {"family" : "MELSECiQR"},
    "cpe:/o:mitsubishielectric:r16mtcpu_firmware" :
        {"family" : "MELSECiQR"},
    "cpe:/o:mitsubishielectric:r32mtcpu_firmware" :
        {"family" : "MELSECiQR"},
    "cpe:/o:mitsubishielectric:r64mtcpu_firmware" :
        {"family" : "MELSECiQR"}
};

tenable_ot::cve::compare_and_report(asset:asset, cpes:vuln_cpes, severity:SECURITY_HOLE);
