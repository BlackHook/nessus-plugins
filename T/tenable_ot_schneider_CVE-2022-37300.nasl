#%NASL_MIN_LEVEL 80900
##
# (C) Tenable, Inc.
##

include('compat.inc');

if (description)
{
  script_id(500700);
  script_version("1.3");
  script_set_attribute(attribute:"plugin_modification_date", value:"2023/04/18");

  script_cve_id("CVE-2022-37300");

  script_name(english:"Schneider (CVE-2022-37300)");

  script_set_attribute(attribute:"synopsis", value:
"The remote OT asset is affected by a vulnerability.");
  script_set_attribute(attribute:"description", value:
"A CWE-640: Weak Password Recovery Mechanism for Forgotten Password vulnerability exists that could cause unauthorized
access in read and write mode to the controller when communicating over Modbus. Affected Products: EcoStruxure Control
Expert Including all Unity Pro versions (former name of EcoStruxure Control Expert) (V15.0 SP1 and prior), EcoStruxure
Process Expert, Including all versions of EcoStruxure Hybrid DCS (former name of EcoStruxure Process Expert) (V2021 and
prior), Modicon M340 CPU (part numbers BMXP34*) (V3.40 and prior), Modicon M580 CPU (part numbers BMEP* and BMEH*)
(V3.20 and prior).

  - A CWE-640: Weak Password Recovery Mechanism for Forgotten Password vulnerability exists that could cause
    unauthorized access in read and write mode to the controller when communicating over Modbus. Affected
    Products: EcoStruxure Control Expert Including all Unity Pro versions (former name of EcoStruxure Control
    Expert) (V15.0 SP1 and prior), EcoStruxure Process Expert, Including all versions of EcoStruxure Hybrid
    DCS (former name of EcoStruxure Process Expert) (V2021 and prior), Modicon M340 CPU (part numbers BMXP34*)
    (V3.40 and prior), Modicon M580 CPU (part numbers BMEP* and BMEH*) (V3.20 and prior). (CVE-2022-37300)

This plugin only works with Tenable.ot. Please visit https://www.tenable.com/products/tenable-ot for more information.");
  script_set_attribute(attribute:"see_also", value:"https://www.se.com/us/en/download/document/SEVD-2022-221-01/");
  script_set_attribute(attribute:"solution", value:
"Refer to the vendor advisory.");
  script_set_cvss3_base_vector("CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H");
  script_set_attribute(attribute:"cvss_score_source", value:"CVE-2022-37300");

  script_set_attribute(attribute:"exploitability_ease", value:"No known exploits are available");
  script_cwe_id(640);

  script_set_attribute(attribute:"vuln_publication_date", value:"2022/09/12");
  script_set_attribute(attribute:"patch_publication_date", value:"2022/09/12");
  script_set_attribute(attribute:"plugin_publication_date", value:"2022/09/15");

  script_set_attribute(attribute:"plugin_type", value:"remote");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:schneider-electric:modicon_m340_bmxp341000_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:schneider-electric:modicon_m340_bmxp342000_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:schneider-electric:modicon_m340_bmxp3420102_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:schneider-electric:modicon_m340_bmxp342010_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:schneider-electric:modicon_m340_bmxp342020_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:schneider-electric:modicon_m340_bmxp342020h_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:schneider-electric:modicon_m340_bmxp3420302_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:schneider-electric:modicon_m340_bmxp3420302h_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:schneider-electric:modicon_m340_bmxp342030_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:schneider-electric:modicon_m340_bmxp342030h_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:schneider-electric:modicon_m580_bmeh582040_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:schneider-electric:modicon_m580_bmeh582040c_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:schneider-electric:modicon_m580_bmeh582040s_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:schneider-electric:modicon_m580_bmeh584040_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:schneider-electric:modicon_m580_bmeh584040c_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:schneider-electric:modicon_m580_bmeh584040s_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:schneider-electric:modicon_m580_bmeh586040_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:schneider-electric:modicon_m580_bmeh586040c_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:schneider-electric:modicon_m580_bmeh586040s_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:schneider-electric:modicon_m580_bmep581020_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:schneider-electric:modicon_m580_bmep581020h_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:schneider-electric:modicon_m580_bmep582020_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:schneider-electric:modicon_m580_bmep582020h_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:schneider-electric:modicon_m580_bmep582040_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:schneider-electric:modicon_m580_bmep582040h_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:schneider-electric:modicon_m580_bmep583020_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:schneider-electric:modicon_m580_bmep583040_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:schneider-electric:modicon_m580_bmep584020_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:schneider-electric:modicon_m580_bmep584040_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:schneider-electric:modicon_m580_bmep584040s_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:schneider-electric:modicon_m580_bmep585040_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:schneider-electric:modicon_m580_bmep585040c_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:schneider-electric:modicon_m580_bmep586040_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:schneider-electric:modicon_m580_bmep586040c_firmware");
  script_end_attributes();

  script_category(ACT_GATHER_INFO);
  script_family(english:"Tenable.ot");

  script_copyright(english:"This script is Copyright (C) 2022-2023 and is owned by Tenable, Inc. or an Affiliate thereof.");

  script_dependencies("tenable_ot_api_integration.nasl");
  script_require_keys("Tenable.ot/Schneider");

  exit(0);
}


include('tenable_ot_cve_funcs.inc');

get_kb_item_or_exit('Tenable.ot/Schneider');

var asset = tenable_ot::assets::get(vendor:'Schneider');

var vuln_cpes = {
    "cpe:/o:schneider-electric:modicon_m340_bmxp341000_firmware" :
        {"versionEndExcluding" : "3.50", "family" : "ModiconM340"},
    "cpe:/o:schneider-electric:modicon_m340_bmxp342000_firmware" :
        {"versionEndExcluding" : "3.50", "family" : "ModiconM340"},
    "cpe:/o:schneider-electric:modicon_m340_bmxp342010_firmware" :
        {"versionEndExcluding" : "3.50", "family" : "ModiconM340"},
    "cpe:/o:schneider-electric:modicon_m340_bmxp3420102_firmware" :
        {"versionEndExcluding" : "3.50", "family" : "ModiconM340"},
    "cpe:/o:schneider-electric:modicon_m340_bmxp342020_firmware" :
        {"versionEndExcluding" : "3.50", "family" : "ModiconM340"},
    "cpe:/o:schneider-electric:modicon_m340_bmxp342020h_firmware" :
        {"versionEndExcluding" : "3.50", "family" : "ModiconM340"},
    "cpe:/o:schneider-electric:modicon_m340_bmxp342030_firmware" :
        {"versionEndExcluding" : "3.50", "family" : "ModiconM340"},
    "cpe:/o:schneider-electric:modicon_m340_bmxp3420302_firmware" :
        {"versionEndExcluding" : "3.50", "family" : "ModiconM340"},
    "cpe:/o:schneider-electric:modicon_m340_bmxp3420302h_firmware" :
        {"versionEndExcluding" : "3.50", "family" : "ModiconM340"},
    "cpe:/o:schneider-electric:modicon_m340_bmxp342030h_firmware" :
        {"versionEndExcluding" : "3.50", "family" : "ModiconM340"},
    "cpe:/o:schneider-electric:modicon_m580_bmeh582040_firmware" :
        {"versionEndExcluding" : "4.02", "family" : "ModiconM580"},
    "cpe:/o:schneider-electric:modicon_m580_bmeh582040c_firmware" :
        {"versionEndExcluding" : "4.02", "family" : "ModiconM580"},
    "cpe:/o:schneider-electric:modicon_m580_bmeh582040s_firmware" :
        {"versionEndExcluding" : "4.02", "family" : "ModiconM580"},
    "cpe:/o:schneider-electric:modicon_m580_bmeh584040_firmware" :
        {"versionEndExcluding" : "4.02", "family" : "ModiconM580"},
    "cpe:/o:schneider-electric:modicon_m580_bmeh584040c_firmware" :
        {"versionEndExcluding" : "4.02", "family" : "ModiconM580"},
    "cpe:/o:schneider-electric:modicon_m580_bmeh584040s_firmware" :
        {"versionEndExcluding" : "4.02", "family" : "ModiconM580"},
    "cpe:/o:schneider-electric:modicon_m580_bmeh586040_firmware" :
        {"versionEndExcluding" : "4.02", "family" : "ModiconM580"},
    "cpe:/o:schneider-electric:modicon_m580_bmeh586040c_firmware" :
        {"versionEndExcluding" : "4.02", "family" : "ModiconM580"},
    "cpe:/o:schneider-electric:modicon_m580_bmeh586040s_firmware" :
        {"versionEndExcluding" : "4.02", "family" : "ModiconM580"},
    "cpe:/o:schneider-electric:modicon_m580_bmep581020_firmware" :
        {"versionEndExcluding" : "4.02", "family" : "ModiconM580"},
    "cpe:/o:schneider-electric:modicon_m580_bmep581020h_firmware" :
        {"versionEndExcluding" : "4.02", "family" : "ModiconM580"},
    "cpe:/o:schneider-electric:modicon_m580_bmep582020_firmware" :
        {"versionEndExcluding" : "4.02", "family" : "ModiconM580"},
    "cpe:/o:schneider-electric:modicon_m580_bmep582020h_firmware" :
        {"versionEndExcluding" : "4.02", "family" : "ModiconM580"},
    "cpe:/o:schneider-electric:modicon_m580_bmep582040_firmware" :
        {"versionEndExcluding" : "4.02", "family" : "ModiconM580"},
    "cpe:/o:schneider-electric:modicon_m580_bmep582040h_firmware" :
        {"versionEndExcluding" : "4.02", "family" : "ModiconM580"},
    "cpe:/o:schneider-electric:modicon_m580_bmep583020_firmware" :
        {"versionEndExcluding" : "4.02", "family" : "ModiconM580"},
    "cpe:/o:schneider-electric:modicon_m580_bmep583040_firmware" :
        {"versionEndExcluding" : "4.02", "family" : "ModiconM580"},
    "cpe:/o:schneider-electric:modicon_m580_bmep584020_firmware" :
        {"versionEndExcluding" : "4.02", "family" : "ModiconM580"},
    "cpe:/o:schneider-electric:modicon_m580_bmep584040_firmware" :
        {"versionEndExcluding" : "4.02", "family" : "ModiconM580"},
    "cpe:/o:schneider-electric:modicon_m580_bmep584040s_firmware" :
        {"versionEndExcluding" : "4.02", "family" : "ModiconM580"},
    "cpe:/o:schneider-electric:modicon_m580_bmep585040_firmware" :
        {"versionEndExcluding" : "4.02", "family" : "ModiconM580"},
    "cpe:/o:schneider-electric:modicon_m580_bmep585040c_firmware" :
        {"versionEndExcluding" : "4.02", "family" : "ModiconM580"},
    "cpe:/o:schneider-electric:modicon_m580_bmep586040_firmware" :
        {"versionEndExcluding" : "4.02", "family" : "ModiconM580"},
    "cpe:/o:schneider-electric:modicon_m580_bmep586040c_firmware" :
        {"versionEndExcluding" : "4.02", "family" : "ModiconM580"}
};

tenable_ot::cve::compare_and_report(asset:asset, cpes:vuln_cpes, severity:SECURITY_HOLE);
