##
# (C) Tenable, Inc.
##

include('compat.inc');

if (description)
{
  script_id(500694);
  script_version("1.3");
  script_set_attribute(attribute:"plugin_modification_date", value:"2023/04/18");

  script_cve_id("CVE-2020-6998");

  script_name(english:"Rockwell (CVE-2020-6998)");

  script_set_attribute(attribute:"synopsis", value:
"The remote OT asset is affected by a vulnerability.");
  script_set_attribute(attribute:"description", value:
"The connection establishment algorithm found in Rockwell Automation CompactLogix 5370 and ControlLogix 5570 versions 33
and prior does not sufficiently manage its control flow during execution, creating an infinite loop. This may allow an
attacker to send specially crafted CIP packet requests to a controller, which may cause denial-of-service conditions in
communications with other products.

  - The connection establishment algorithm found in Rockwell Automation CompactLogix 5370 and ControlLogix
    5570 versions 33 and prior does not sufficiently manage its control flow during execution, creating an
    infinite loop. This may allow an attacker to send specially crafted CIP packet requests to a controller,
    which may cause denial-of-service conditions in communications with other products. (CVE-2020-6998)

This plugin only works with Tenable.ot. Please visit https://www.tenable.com/products/tenable-ot for more information.");
  # https://rockwellautomation.custhelp.com/app/answers/answer_view/a_id/1130398
  script_set_attribute(attribute:"see_also", value:"http://www.nessus.org/u?f175e2a0");
  script_set_attribute(attribute:"see_also", value:"https://www.cisa.gov/uscert/ics/advisories/icsa-21-061-02");
  script_set_attribute(attribute:"solution", value:
"Refer to the vendor advisory.");
  script_set_cvss3_base_vector("CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:C/C:N/I:N/A:H");
  script_set_attribute(attribute:"cvss_score_source", value:"CVE-2020-6998");

  script_set_attribute(attribute:"exploitability_ease", value:"No known exploits are available");
  script_cwe_id(20);

  script_set_attribute(attribute:"vuln_publication_date", value:"2022/07/27");
  script_set_attribute(attribute:"patch_publication_date", value:"2022/07/27");
  script_set_attribute(attribute:"plugin_publication_date", value:"2022/08/04");

  script_set_attribute(attribute:"plugin_type", value:"remote");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:rockwellautomation:armor_compact_guardlogix_5370_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:rockwellautomation:compact_guardlogix_5370_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:rockwellautomation:compactlogix_5370_l1_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:rockwellautomation:compactlogix_5370_l2_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:rockwellautomation:compactlogix_5370_l3_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:rockwellautomation:controllogix_5570_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:rockwellautomation:guardlogix_5560_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:rockwellautomation:guardlogix_5570_firmware");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:rockwellautomation:guardlogix_5580_firmware");
  script_end_attributes();

  script_category(ACT_GATHER_INFO);
  script_family(english:"Tenable.ot");

  script_copyright(english:"This script is Copyright (C) 2022-2023 and is owned by Tenable, Inc. or an Affiliate thereof.");

  script_dependencies("tenable_ot_api_integration.nasl");
  script_require_keys("Tenable.ot/Rockwell");

  exit(0);
}


include('tenable_ot_cve_funcs.inc');

get_kb_item_or_exit('Tenable.ot/Rockwell');

var asset = tenable_ot::assets::get(vendor:'Rockwell');

var vuln_cpes = {
    "cpe:/o:rockwellautomation:armor_compact_guardlogix_5370_firmware" :
        {"versionEndIncluding" : "33", "family" : "GuardLogix5370"},
    "cpe:/o:rockwellautomation:compact_guardlogix_5370_firmware" :
        {"versionEndIncluding" : "33", "family" : "GuardLogix5370"},
    "cpe:/o:rockwellautomation:compactlogix_5370_l1_firmware" :
        {"versionEndIncluding" : "33", "family" : "CompactLogix5370"},
    "cpe:/o:rockwellautomation:compactlogix_5370_l2_firmware" :
        {"versionEndIncluding" : "33", "family" : "CompactLogix5370"},
    "cpe:/o:rockwellautomation:compactlogix_5370_l3_firmware" :
        {"versionEndIncluding" : "33", "family" : "CompactLogix5370"},
    "cpe:/o:rockwellautomation:controllogix_5570_firmware" :
        {"versionEndIncluding" : "33", "family" : "ControlLogix5570"},
    "cpe:/o:rockwellautomation:guardlogix_5560_firmware" :
        {"versionEndIncluding" : "33", "family" : "GuardLogix5560"},
    "cpe:/o:rockwellautomation:guardlogix_5570_firmware" :
        {"versionEndIncluding" : "33", "family" : "GuardLogix5570"},
    "cpe:/o:rockwellautomation:guardlogix_5580_firmware" :
        {"versionEndIncluding" : "33", "family" : "GuardLogix5580"}
};

tenable_ot::cve::compare_and_report(asset:asset, cpes:vuln_cpes, severity:SECURITY_HOLE);
