#%NASL_MIN_LEVEL 70300
##
# (C) Tenable, Inc.
##

include('deprecated_nasl_level.inc');
include('compat.inc');

if (description)
{
  script_id(500121);
  script_version("1.4");
  script_set_attribute(attribute:"plugin_modification_date", value:"2023/05/03");

  script_cve_id("CVE-2016-8672");

  script_name(english:"Siemens (CVE-2016-8672)");

  script_set_attribute(attribute:"synopsis", value:
"The remote OT asset is affected by a vulnerability.");
  script_set_attribute(attribute:"description", value:
"A vulnerability has been identified in SIMATIC CP 343-1 Advanced
(incl. SIPLUS NET variant) (All versions < V3.0.53), SIMATIC CP 443-1
Advanced (incl. SIPLUS NET variant) (All versions < V3.2.17), SIMATIC
S7-300 PN/DP CPU family (incl. SIPLUS variants) (All versions),
SIMATIC S7-400 PN/DP CPU family (incl. SIPLUS variants) (All
versions). The integrated web server delivers cookies without the
secure flag. Modern browsers interpreting the flag would mitigate
potential data leakage in case of clear text transmission.

This plugin only works with Tenable.ot.
Please visit https://www.tenable.com/products/tenable-ot for more information.");
  script_set_attribute(attribute:"see_also", value:"https://cert-portal.siemens.com/productcert/pdf/ssa-603476.pdf");
  script_set_attribute(attribute:"solution", value:
"Refer to the vendor advisory.");
  script_set_cvss_base_vector("CVSS2#AV:N/AC:L/Au:N/C:P/I:N/A:N");
  script_set_cvss3_base_vector("CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:N/A:N");
  script_set_attribute(attribute:"cvss_score_source", value:"CVE-2016-8672");

  script_set_attribute(attribute:"exploitability_ease", value:"No known exploits are available");
  script_cwe_id(200);

  script_set_attribute(attribute:"vuln_publication_date", value:"2016/11/23");
  script_set_attribute(attribute:"patch_publication_date", value:"2016/11/23");
  script_set_attribute(attribute:"plugin_publication_date", value:"2022/02/07");

  script_set_attribute(attribute:"plugin_type", value:"remote");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_cp_343-1_advanced_firmware:-");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_cp_443-1_advanced_firmware:-");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7_300_cpu_firmware:-");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:siemens:simatic_s7_400_cpu_firmware:-");
  script_end_attributes();

  script_category(ACT_GATHER_INFO);
  script_family(english:"Tenable.ot");

  script_copyright(english:"This script is Copyright (C) 2022-2023 and is owned by Tenable, Inc. or an Affiliate thereof.");

  script_dependencies("tenable_ot_api_integration.nasl");
  script_require_keys("Tenable.ot/Siemens");

  exit(0);
}


include('tenable_ot_cve_funcs.inc');

get_kb_item_or_exit('Tenable.ot/Siemens');

var asset = tenable_ot::assets::get(vendor:'Siemens');

var vuln_cpes = {
    "cpe:/o:siemens:simatic_cp_343-1_advanced_firmware:-" :
        {"family" : "S7300", "versionEndExcluding" : "3.0.53"},
    "cpe:/o:siemens:simatic_s7_300_cpu_firmware:-" :
        {"family" : "S7300"},
    "cpe:/o:siemens:simatic_s7_400_cpu_firmware:-" :
        {"family" : "S7400"},
    "cpe:/o:siemens:simatic_cp_443-1_advanced_firmware:-" :
        {"family" : "S7400", "versionEndExcluding" : "3.2.17"}
};

tenable_ot::cve::compare_and_report(asset:asset, cpes:vuln_cpes, severity:SECURITY_WARNING);
