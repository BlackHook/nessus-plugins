#TRUSTED 7fa99ecdfd3047c62670357da52cf2437657bfdde27ed7dbf2366d0c166d0708ba6217f5b87c68387d251a2b7637b05f6e3c204932f1d78b7a44f3324b76a3970bb2308b0cd704b332beac1449a22d2cc621fd890e951b7652c36bbb05b9f540feaa243f4f436e2d9a1917abedae1733da71534bf31b0203f656e3bdfbb4633f29a6255028b8978b9500eb31e082541e859e7a4be170e3daa90716233525c3bfe2c2d991d637f467cc141cb57c24611f7470e65f88c53ef7ce335b2df73fb568476f56db6b2c3d4ccca84b4d0f76f847da9b5af74e7470c179da13a70770909bfdfed5f28a1a9c77b6d7250ce89338d9918ac8df41790c37e8cfa1b1ddcd3fe23cf15811d51a87ec2887994a7bbfd0eccc35bcbe776dd4221a758f32a87fed59d450e5a9b813d9f48c1a9f311adaf1646d74d8ae114596494cb378e38a6abd4680db14a2b077013af9dc12e6a147de38d29050c021d831b279d2fb96075b082e8f3398af1e1552c9dc27ae13c6b714ac52aa2692cc6da1805b2f117e3cfd6c5d50063f1156a9a1c4bb32297bfd040f1d2cc718e077a514d8ce77f9609745e88265030503fa30e2bdd93d84787595cee360b80d3e902b4b3a0f0fcf96a11daeeb4362b632876f3c9c5a6e1f8788f953f31b13e32442f12005a545ec458333a28a1d8f402902c88f7b3c44e01fd70f906f3de4c109a285e1215ec6c32a9f52f10f
#
# (C) Tenable Network Security, Inc.
#

include("compat.inc");

if (description)
{
  script_id(78825);
  script_version("1.9");
  script_set_attribute(attribute:"plugin_modification_date", value:"2018/11/15");

  script_cve_id("CVE-2013-5527");
  script_bugtraq_id(62904);
  script_xref(name:"CISCO-BUG-ID", value:"CSCui21030");

  script_name(english:"Cisco IOS XE OSPF Opaque LSA DoS (CSCui21030)");
  script_summary(english:"Checks the IOS XE version.");

  script_set_attribute(attribute:"synopsis", value:
"The remote device is affected by a denial of service vulnerability.");
  script_set_attribute(attribute:"description", value:
"The remote Cisco device is affected by a denial of service
vulnerability due to improper parsing of certain options in OSPF
link-state advertisement (LSA) type 11 packets. A remote,
unauthenticated attacker, using specially crafted OSPF packets with
unusual options can cause a device reload, resulting in a denial of
service.");
  # https://tools.cisco.com/security/center/viewAlert.x?alertId=31201
  script_set_attribute(attribute:"see_also", value:"http://www.nessus.org/u?2a23d9c5");
  script_set_attribute(attribute:"see_also", value:"https://tools.cisco.com/security/center/viewAlert.x?alertId=31201");
  script_set_attribute(attribute:"solution", value:
"Upgrade to the relevant fixed version referenced in Cisco bug ID
CSCui21030.");
  
  script_set_cvss_base_vector("CVSS2#AV:A/AC:M/Au:N/C:N/I:N/A:C");
  script_set_cvss_temporal_vector("CVSS2#E:U/RL:OF/RC:C");
  script_set_attribute(attribute:"exploitability_ease", value:"No known exploits are available");
  script_set_attribute(attribute:"exploit_available", value:"false");

  script_set_attribute(attribute:"vuln_publication_date", value:"2013/10/10");
  script_set_attribute(attribute:"patch_publication_date", value:"2014/10/10");
  script_set_attribute(attribute:"plugin_publication_date", value:"2014/11/03");

  script_set_attribute(attribute:"plugin_type", value:"local");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:cisco:ios_xe");
  script_end_attributes();

  script_category(ACT_GATHER_INFO);
  script_family(english:"CISCO");

  script_copyright(english:"This script is Copyright (C) 2014-2018 Tenable Network Security, Inc.");

  script_dependencies("cisco_ios_xe_version.nasl");
  script_require_keys("Host/Cisco/IOS-XE/Version");

  exit(0);
}

include("audit.inc");
include("cisco_func.inc");
include("cisco_kb_cmd_func.inc");

# According to the bug ID, the following version are affected :
# 3.3.0S, 3.3.1S, 3.3.2S, 3.9.0S, 3.9.1S

version = get_kb_item_or_exit("Host/Cisco/IOS-XE/Version");

flag = 0;

if (
  version =~ "3\.3\.[0-2]S" ||
  version =~ "3\.9\.[0-1]S"
) flag++;

if (get_kb_item("Host/local_checks_enabled") && flag)
{
  flag = 0;
  buf = cisco_command_kb_item("Host/Cisco/Config/show_ip_osfp", "show ip osfp");
  if (check_cisco_result(buf))
  {
    if ('Routing Process "ospf' >< buf) flag = 1;
  }
  else if (cisco_needs_enable(buf))
  {
    flag = 1;
    override = 1;
  }
}

if(flag)
{
  if (report_verbosity > 0)
  {
    report =
    '\n  Cisco bug ID      : CSCui21030' +
    '\n  Installed release : ' + version +
    '\n';
    security_warning(port:0, extra:report + cisco_caveat(override));
  }
  else security_warning(port:0, extra:cisco_caveat(override));
  exit(0);
}
else audit(AUDIT_HOST_NOT, "affected");
