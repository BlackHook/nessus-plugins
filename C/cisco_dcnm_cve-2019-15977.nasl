#TRUSTED 1fc7a8a95a8985acbf6a75cf4010e61b9df90a0c50ce19f24afbffc3ef39f99800a4267b883591563868466ff71ff559d2ee4bfe20cf505f661ceb1f4d15eb2bf2a4b424c2535f6c02d65c80f03fcc80614dab678576b5e6c52d8504b31d67533fc58070c426d89af024d0147f5659e734ff26ff5a1cf485b7e3d4069d3f4330bd825e64a666e562969a003eecb22957b2191c7d74245512030149b51d53e406bf400b28ce67d5059c118b252aac7573bf4f18f522c8a2ffdd837bad2a91061876dbd53cf2325c71af6a6cd2e6c992d58baa170c70af7288804e5130a24b31b36c42dbc8875d47f55e3b15f694c8e496cc9aa5acbbfc2e2d0bcb2b88232b00af631073ac35ced4b6aa918496a2b0af2d179dfc00b2242a85ea9ff7e4f24a95ff39bed4784fcb0b6596316b134adf9e46558a41eb813ae30b9df88d0b1a5f79b20f9adaeb69854f4a1a54480e3fa7bacc4f3bfac6b5e528ec1c88af412138f8f794e439cb7ec1219589b3c39e718d14dfff8b25276f5429e7f09d357620d7f1260ee33aedd8243ba5eaead1fc12a67fe5a3719d3ab1a138a9285ebd1ee51387073fe2d91c5b718192d685be08d48f6c472b89bca463b31e17b7e35de91457d9f93c6bf25fcba7546763a8c58716d3d8064004806feb993c61c7c78c6d10786d1f7387afdfd2d64f9dc1f70233bbb314f166adaebd67bf5afea226180f51d7105d
#TRUST-RSA-SHA256 5731d442db43206b9e88865ba399c55c0f30afbfbddab4f630bac09a3f82fa0fe5dcf84e43e3010c67db09681742ed4fa408abdb32b036fb983a4e4ba9142e24dde01e15a752adb7ff46dd33c9ac507ba324c1541833d62fb97f981e6031b2f26742e3332e4329374be20645626b755696cac000b0edc3d2bf23921d97b0a5c14db2a84d13113a2680351c5309d63e30acebac03bd7d7f3eab3be6f414b68508ce40c13c9bc3900320b2bec410323e0120b6b204384e18834f34c5d07e1fab5b949368bd0b5bc22f6f4eb23a136d24e3e5fa693df417d3c9e5528e722ad7c7562c79cc22aff4010802b461b07a2bcafe35c15175cf2af426671999cb639423dc9ad96ccdab64e64d25219de390b8133a070fecc332e904907a32a4d47cd4ec9856f522c0b244a35b20f1ac2374b7de8164313695b20979213a375344f65318e65d9883e89485ff0182daa68e96b657481b2f8f4e8883d3b3aee1ba2500d47c0fe670ad88ef2f6d951c1a1f0bd4024da03775de30b7b840bcdf0425351474841669bd9898d26fe432e0de1ed3a7a79dd62831eb3f4ef0e63d5d0e0363d01b0531369391f0bc07caad97015f4d53656c971281a045e447ecb90e243af8ef6ebe98e27c0148f5d445c0c15df47bda304ccff419941c904fd878edc1a4b6bdbb334b80cae638797af2407c9e3d3fb179492d013ce93415c7bcbfc6b12e86d4e0fb5a
#
# (C) Tenable Network Security, Inc.
#

include('compat.inc');

if (description)
{
  script_id(133078);
  script_version("1.10");
  script_set_attribute(attribute:"plugin_modification_date", value:"2022/12/05");

  script_cve_id("CVE-2019-15977");
  script_xref(name:"CISCO-BUG-ID", value:"CSCvq89859");
  script_xref(name:"CISCO-SA", value:"cisco-sa-20200102-dcnm-auth-bypass");
  script_xref(name:"CEA-ID", value:"CEA-2020-0004");

  script_name(english:"Cisco DCNM Authentication Bypass (CVE-2019-15977)");

  script_set_attribute(attribute:"synopsis", value:
"A web application running on the remote host contains an authentication bypass vulnerability.");
  script_set_attribute(attribute:"description", value:
"The version of Cisco Data Center Network Manager (DCNM) running on the remote web server is affected by an
authentication bypass vulnerability that can lead to information disclosure. An unauthenticated, remote attacker can
exploit this issue, by logging into specific sections of the web management interface with hardcoded credentials. The
information revealed through this vulnerability may be used in combination with other vulnerabilities to achieve remote
code execution.");
  # https://srcincite.io/blog/2020/01/14/busting-ciscos-beans-hardcoding-your-way-to-hell.html
  script_set_attribute(attribute:"see_also", value:"http://www.nessus.org/u?0dee461d");
  # https://tools.cisco.com/security/center/content/CiscoSecurityAdvisory/cisco-sa-20200102-dcnm-auth-bypass
  script_set_attribute(attribute:"see_also", value:"http://www.nessus.org/u?7295287f");
  script_set_attribute(attribute:"solution", value:
"Upgrade to Cisco Data Center Network Manager version 11.3(1) or later.");
  script_set_cvss_base_vector("CVSS2#AV:N/AC:L/Au:N/C:C/I:N/A:N");
  script_set_cvss_temporal_vector("CVSS2#E:POC/RL:OF/RC:C");
  script_set_cvss3_base_vector("CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N");
  script_set_cvss3_temporal_vector("CVSS:3.0/E:P/RL:O/RC:C");
  script_set_attribute(attribute:"cvss_score_source", value:"CVE-2019-15977");

  script_set_attribute(attribute:"exploitability_ease", value:"Exploits are available");
  script_set_attribute(attribute:"exploit_available", value:"true");

  script_set_attribute(attribute:"vuln_publication_date", value:"2019/01/02");
  script_set_attribute(attribute:"patch_publication_date", value:"2019/12/25");
  script_set_attribute(attribute:"plugin_publication_date", value:"2020/01/20");

  script_set_attribute(attribute:"plugin_type", value:"remote");
  script_set_attribute(attribute:"cpe", value:"cpe:/a:cisco:data_center_network_manager");
  script_end_attributes();

  script_category(ACT_ATTACK);
  script_family(english:"CGI abuses");

  script_copyright(english:"This script is Copyright (C) 2020-2022 and is owned by Tenable, Inc. or an Affiliate thereof.");

  script_dependencies("cisco_prime_dcnm_web_detect.nasl");
  script_require_keys("installed_sw/cisco_dcnm_web");
  script_exclude_keys("global_settings/supplied_logins_only");
  script_require_ports("Services/www", 443);

  exit(0);
}

include('http.inc');
include('install_func.inc');

if (supplied_logins_only) audit(AUDIT_SUPPLIED_LOGINS_ONLY);

appname = 'Cisco DCNM';
app_id  = 'cisco_dcnm_web';

# Exit if app is not detected on the target
get_install_count(app_name:app_id, exit_if_zero:TRUE);

port = get_http_port(default:443);
install = get_single_install(app_name:app_id, port:port);

url = '/serverinfo/HtmlAdaptor?action=displayServerInfos';

# Hardcoded credentials
user = 'admin';
pass = 'nbv_12345';

res = http_send_recv3(
  method : 'GET',
  port   : port,
  item   : url,
  add_headers : make_array("Authorization", "Basic " + base64(str:user+":"+pass)),
  exit_on_fail : TRUE
);

if ('200' >< res[0])
{
  security_report_v4(
    port        : port,
    severity    : SECURITY_HOLE,
    generic     : TRUE,
    request     : make_list(http_last_sent_request()),
    output      : res[0] + res[1] + res[2]
  );
}
else
{
  audit(AUDIT_WEB_APP_NOT_AFFECTED, appname, build_url(qs:install['path'], port:port));
}
