#TRUSTED 28a905c5a561cfaa42d1748ed4062002a1c7ba4da3aa6fb8426ae22bc31e2cbfb6512fdbfb2e1255278f5d5ef3e866ad947d6bf1cc7274ad29569f62de3d06569e8c2d7c8f5925a02bc8fb056f755db4b74e3979613f1a2d5da284c9994910f9db0e58696c3b061a755bb9e9fe75045383c92c689b5fdff8dde7b3ce577403cafe417fd3811062c3d7d15654e75eecc808cf5880c6465b40fc79d8c38d84c989c192d9c6f30f9f147dc4811cd1f165eb8410a9c5b90b29f476dfd4e35c9afc859cf49dc6ffcdcfbf360bf0a6564073bc328ae6b14ebd3ee06b35aef323c1d05880fbf6ece660dfd656650b4791d16d79b5306dab96ec359b5e116be26ee1196f8749791b0a13d445474da2cd1654d4ca216ac86bee222a0c66cd46a5e8fd4e46b2c7ddb1a27852f544f01d9062f43385e4af79cf700ae9092c4b3439908aaf6c8a312dc6584d2b3044f673650f7f48339bb28de3ac3ad6e1c12b9f32a06bd41b110d8cf314c49a3ed2e1255c893ff47985a56fa008ca3a5b00c0e52144bf0aa9065a12874bf976cf47134943bd1ae5ff272a0ea1576ce165d7fa8720180eddeda0fd196a5ef5965404792f7ff7334d46ee9f05259c22f5190b9114921853d551c60aa7c3c9aa266d9fd84085a8bbbb55e4d16d64f79bdad5f33a4ce6617de7ba7d15697d266e74ca0b71bdd9e28c24a9b05955f17128ce5df7c1c50df35f1d27
#
# (C) Tenable Network Security, Inc.
#

include("compat.inc");

if (description)
{
  script_id(76969);
  script_version("1.7");
  script_set_attribute(attribute:"plugin_modification_date", value:"2018/11/15");

  script_cve_id("CVE-2014-3269");
  script_bugtraq_id(67459);
  script_xref(name:"CISCO-BUG-ID", value:"CSCug65204");

  script_name(english:"Cisco IOS XE SNMP DoS (CSCug65204)");
  script_summary(english:"Checks IOS XE version.");

  script_set_attribute(attribute:"synopsis", value:"The remote device is affected by a denial of service vulnerability.");
  script_set_attribute(attribute:"description", value:
"The remote Cisco device potentially contains an issue in the SNMP
module which may allow remote authenticated users to cause a denial of
service (device reload) via continuous SNMP polling requests.");
  # https://tools.cisco.com/security/center/viewAlert.x?alertId=34268
  script_set_attribute(attribute:"see_also", value:"http://www.nessus.org/u?252ae070");
  script_set_attribute(attribute:"see_also", value:"https://tools.cisco.com/security/center/viewAlert.x?alertId=34268");
  script_set_attribute(attribute:"solution", value:
"Upgrade to the relevant fixed version referenced in Cisco bug ID
CSCug65204.");
  script_set_cvss_base_vector("CVSS2#AV:N/AC:L/Au:S/C:N/I:N/A:C");
  script_set_cvss_temporal_vector("CVSS2#E:U/RL:OF/RC:C");
  script_set_attribute(attribute:"exploitability_ease", value:"No known exploits are available");
  script_set_attribute(attribute:"exploit_available", value:"false");

  script_set_attribute(attribute:"vuln_publication_date", value:"2014/05/16");
  script_set_attribute(attribute:"patch_publication_date", value:"2014/05/20");
  script_set_attribute(attribute:"plugin_publication_date", value:"2014/08/01");

  script_set_attribute(attribute:"plugin_type", value:"local");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:cisco:ios_xe");
  script_end_attributes();

  script_category(ACT_GATHER_INFO);
  script_family(english:"CISCO");

  script_copyright(english:"This script is Copyright (C) 2014-2018 Tenable Network Security, Inc.");

  script_dependencies("cisco_ios_xe_version.nasl");
  script_require_keys("Host/Cisco/IOS-XE/Version");

  exit(0);
}

include("audit.inc");
include("cisco_func.inc");
include("cisco_kb_cmd_func.inc");

flag = 0;
override = 0;

# According to security note and CVE, 3.5E base is affected.
# According to CSCug65204, 3.3.*SG, 3.4.0SG, and 3.4.1SG are also affected
version = get_kb_item_or_exit("Host/Cisco/IOS-XE/Version");
if (version == '3.5.0E' || version =~ "^3\.4\.[01]SG$" || version =~ "^3\.3\.[0-9]SG$")
  flag++;


if (flag)
{
  flag = 0;

  # Check for SUP7E or SUP7L-E modules
  if (get_kb_item("Host/local_checks_enabled"))
  {
    buf = cisco_command_kb_item("Host/Cisco/Config/show_module", "show module");
    if (check_cisco_result(buf))
    {
      if (preg(pattern:"WS-X45-SUP7L?-E ", multiline:TRUE, string:buf)) flag++;
    }
    else if (cisco_needs_enable(buf))
    {
      flag++;
      override++;
    }
  }

  # Check for 4500-X model
  model = get_kb_item_or_exit("Host/Cisco/IOS-XE/Model");
  if (model =~ "Catalyst 45[0-9][0-9]-X($|[^0-9])") flag++;
}


if (flag)
{
  if (report_verbosity > 0)
  {
    report =
    '\n  Cisco Bug ID      : CSCug65204' +
    '\n  Installed release : ' + version +
    '\n';
    security_warning(port:0, extra:report + cisco_caveat(override));
  }
  else security_warning(port:0, extra:cisco_caveat(override));
  exit(0);
}
else audit(AUDIT_HOST_NOT, "affected");
