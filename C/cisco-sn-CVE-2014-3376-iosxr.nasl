#TRUSTED 4f26b194163856cd094fce8eac1db1c686a24c5d0588abdea4b79214e56ec209ff19759ea092145c737d6e94c990854c91a91bfdf0dad76cde36106f4d39e2f6fbe3afd63700ce0dee940443ec666c87de80f38217b38df527cc805bb94fd2c31b1380d220a74cf68449ba3a881ac8973ab67f44ab479afbf7d6c5cbc9e4cad82f212527448344ba58c4ab6f5269cdfbb4dcd7d11758ab9738ab8ebf545d27cf05e296c82dd6d2bd3e2734cddf14e5eb0754918afcf5fea57c4ddedcb67f15b81174946b559a81245a56db450cb5bddd4fb40b84e06cfdba7ea19aed9435d9562e3d94a91099a700ebfdd1cc5757e783a9bf6eee06954133082608b6afe351a67ffe66e56aa3ae73188a0598bd7a1c67ff7d41d8db19ae136d1b582710c9c3f2df98b0b7bece6b4be7ba84f73bb10a7f1a3a3e96243173693ff8c9f07b91c2cf27a7821fdc063fbe93c7c2919684de0ae9b41b8b6828e9c8e535b58e1d493b60e2fe34b8c12c0f2fae97161c56a93a7502ca4c33bf6feea9f17ed7765090c77a33ad12e67e32f9952d4824ef49333b0de07ada9948d54d26f887341e7cd8ef8900894086dceaa62f036ec578b653d48b40b34af8e24d168676ce848bf90913e37cb44c8a48b8e9ee2f956b7b83e399ed762fe49712eb7ba7073ef42409eeca5c28a9774b7c31bcb446fb3885abfd601b042c2c7a8b550ffdd1d02c83d047d2ce
#
# (C) Tenable Network Security, Inc.
#

include("compat.inc");

if (description)
{
  script_id(79625);
  script_version("1.7");
  script_set_attribute(attribute:"plugin_modification_date", value:"2021/04/08");

  script_cve_id("CVE-2014-3376");
  script_bugtraq_id(69956);
  script_xref(name:"CISCO-BUG-ID", value:"CSCuq12031");

  script_name(english:"Cisco IOS XR Malformed RSVP Packet DoS");
  script_summary(english:"Checks the IOS XR version.");

  script_set_attribute(attribute:"synopsis", value:"The remote device is missing a vendor-supplied security patch.");
  script_set_attribute(attribute:"description", value:
"The remote Cisco device is running a version of IOS XR software that
is affected by a denial of service vulnerability related to the
improper parsing of malformed RSVP packets.");
  # https://tools.cisco.com/security/center/viewAlert.x?alertId=35773
  script_set_attribute(attribute:"see_also", value:"http://www.nessus.org/u?2504735b");
  # https://tools.cisco.com/security/center/viewAlert.x?alertId=35773
  script_set_attribute(attribute:"see_also", value:"http://www.nessus.org/u?2504735b");
  script_set_attribute(attribute:"solution", value:"Apply the relevant patch referenced in Cisco bug ID CSCuq12031.");
  script_set_cvss_base_vector("CVSS2#AV:N/AC:L/Au:N/C:N/I:N/A:P");
  script_set_cvss_temporal_vector("CVSS2#E:U/RL:OF/RC:C");
  script_set_attribute(attribute:"cvss_score_source", value:"CVE-2014-3376");

  script_set_attribute(attribute:"exploitability_ease", value:"No known exploits are available");
  script_set_attribute(attribute:"exploit_available", value:"false");

  script_set_attribute(attribute:"vuln_publication_date", value:"2014/09/18");
  script_set_attribute(attribute:"patch_publication_date", value:"2014/09/18");
  script_set_attribute(attribute:"plugin_publication_date", value:"2014/11/28");

  script_set_attribute(attribute:"plugin_type", value:"combined");
  script_set_attribute(attribute:"cpe", value:"cpe:/o:cisco:ios_xr");
  script_end_attributes();

  script_category(ACT_GATHER_INFO);
  script_copyright(english:"This script is (C) 2014-2021 Tenable Network Security, Inc.");
  script_family(english:"CISCO");

  script_dependencies("cisco_ios_xr_version.nasl");
  script_require_keys("Host/Cisco/IOS-XR/Version");

  exit(0);
}

include("audit.inc");
include("cisco_func.inc");
include("cisco_kb_cmd_func.inc");

version  = get_kb_item_or_exit("Host/Cisco/IOS-XR/Version");

flag     = FALSE;
override = FALSE;

if (version =~ "^5\.0\.")
  flag = TRUE;
else if (version =~ "^5\.1\.4" && ver_compare(ver:version, fix:"5.1.4.1" , strict:FALSE) < 0)
  flag = TRUE;
else if (version =~ "^5\.1\."  && ver_compare(ver:version, fix:"5.1.3.19", strict:FALSE) < 0)
  flag = TRUE;
else if (version =~ "^5\.2\."  && ver_compare(ver:version, fix:"5.2.1.29", strict:FALSE) < 0)
  flag = TRUE;

if (!flag) audit(AUDIT_INST_VER_NOT_VULN, 'Cisco IOS XR', version);

port = get_kb_item("Host/Cisco/IOS-XR/Port");
if(empty_or_null(port))
  port = 0;

if (!isnull(get_kb_item("Host/local_checks_enabled")))
{
  buf = cisco_command_kb_item("Host/Cisco/Config/show_rsvp_interface_detail", "show rsvp interface detail");
  # Check for basic RSVP config
  if (check_cisco_result(buf))
  {
      if ("INTERFACE:" >!< buf || "BW (bits/sec):" >!< buf) audit(AUDIT_HOST_NOT, "affected because RSVP is not enabled.");
  }
  else if (cisco_needs_enable(buf)) override = TRUE;
}

if (report_verbosity > 0)
{
  report =
    '\n  Cisco bug IDs     : CSCuq12031' +
    '\n  Installed release : ' + version +
    '\n';
  security_warning(port:port, extra:report+cisco_caveat(override));
}
else security_warning(port:port, extra:cisco_caveat(override));
