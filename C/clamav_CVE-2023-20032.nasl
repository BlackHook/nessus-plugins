#%NASL_MIN_LEVEL 80900
##
# (C) Tenable, Inc.
##

include('compat.inc');

if (description)
{
  script_id(177449);
  script_version("1.1");
  script_set_attribute(attribute:"plugin_modification_date", value:"2023/06/20");

  script_cve_id("CVE-2023-20032");

  script_name(english:"ClamAV < 0.103.8 / 0.104.x < 0.105.2 / 1.0.x < 1.0.1 RCE");

  script_set_attribute(attribute:"synopsis", value:
"The antivirus running on the remote host is affected by a remote code execution vulnerability.");
  script_set_attribute(attribute:"description", value:
"The version of ClamAV installed on the remote host is prior to 0.103.8, 0.104.x prior to 0.105.2 or 1.0.x 
prior to 1.0.1. It is, therefore, affected by a remote code execution vulnerability in the HFS+ partition file parser of
the ClamAV scanning library. An unauthenticated, remote attacker could exploit this vulnerability by submitting a 
crafted HFS+ partition file to be scanned by ClamAV on an affected device. Successful exploitation could allow the 
attacker to execute arbitrary code with the privileges of the ClamAV scanning process, or else crash the process, 
resulting in a denial of service (DoS) condition.

Note that Nessus has not tested for this issue but has instead relied only on the application's self-reported version
number.");
  script_set_attribute(attribute:"see_also", value:"https://nvd.nist.gov/vuln/detail/CVE-2023-20032");
  script_set_attribute(attribute:"see_also", value:"https://blog.clamav.net/2023/02/clamav-01038-01052-and-101-patch.html");
  script_set_attribute(attribute:"solution", value:
"Upgrade to ClamAV version 0.103.8, 0.105.2, 1.0.1 or later.");
  script_set_cvss_base_vector("CVSS2#AV:N/AC:L/Au:N/C:C/I:C/A:C");
  script_set_cvss_temporal_vector("CVSS2#E:U/RL:OF/RC:C");
  script_set_cvss3_base_vector("CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H");
  script_set_cvss3_temporal_vector("CVSS:3.0/E:U/RL:O/RC:C");
  script_set_attribute(attribute:"cvss_score_source", value:"CVE-2023-20032");

  script_set_attribute(attribute:"exploitability_ease", value:"No known exploits are available");

  script_set_attribute(attribute:"vuln_publication_date", value:"2023/02/15");
  script_set_attribute(attribute:"patch_publication_date", value:"2023/02/15");
  script_set_attribute(attribute:"plugin_publication_date", value:"2023/06/20");

  script_set_attribute(attribute:"plugin_type", value:"combined");
  script_set_attribute(attribute:"cpe", value:"cpe:/a:clamav:clamav");
  script_set_attribute(attribute:"thorough_tests", value:"true");
  script_end_attributes();

  script_category(ACT_GATHER_INFO);
  script_family(english:"Misc.");

  script_copyright(english:"This script is Copyright (C) 2023 and is owned by Tenable, Inc. or an Affiliate thereof.");

  script_dependencies("clamav_detect.nasl", "clamav_installed.nbin", "clamav_nix_installed.nbin");
  script_require_keys("installed_sw/ClamAV");

  exit(0);
}

include('vcf.inc');

var app_info = vcf::combined_get_app_info(app:'ClamAV');

var constraints = [
  { 'fixed_version' : '0.103.8' },
  { 'min_version' : '0.104.0-rc', 'fixed_version' : '0.105.2' },
  { 'min_version' : '1.0.0-rc', 'fixed_version' : '1.0.1' }
];

vcf::check_version_and_report(app_info:app_info, constraints:constraints, severity:SECURITY_HOLE);